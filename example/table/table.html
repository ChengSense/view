<!DOCTYPE html>
<html>

<head>
  <title>main.html</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link href="https://kendo.cdn.telerik.com/2018.3.1017/styles/kendo.common.min.css" rel="stylesheet" />
  <link href="https://kendo.cdn.telerik.com/2018.3.1017/styles/kendo.rtl.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <link href="https://kendo.cdn.telerik.com/2018.3.1017/styles/kendo.silver.min.css" rel="stylesheet" />
  <script type="text/javascript" src="../../release/view.js"></script>
  <style>
    input {
      border-width: 0px;
      background-color: rgba(255, 255, 255, 0);
      width: 100%;
      height: 20px
    }
  
    .k-unselect {
      -webkit-user-select: none;
      -ms-user-select: none;
      -moz-user-select: none;
    }
  </style>
</head>

<body>
  <div id="grid" class="k-grid k-widget k-display-block">
    <div class="k-grid-header" style="padding-right: 17px;">
      <div class="k-grid-header-wrap k-auto-scrollable scrollable">
        <table>
          <thead>
            <tr>
              <th 
                class="k-header k-unselect" 
                data-field="{i}" 
                @mousemove="resize"
                each="item:i:columns">
              {item}</th>
              <th class="k-header">操作项</th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
    <div class="k-grid-content k-auto-scrollable" style="height: 643px;" @scroll="scroll">
      <table style="height: auto;">
        <tbody>
          <tr each="item:id:list" class="{id%2?'k-alt':''}">
            <td each="col:i:item" data-field="{i}" data-row="{id}">
              @when(edit==id){
                <input value="{col}">
              }.when{ 
                {col} 
              }
            </td>
            <td>
              <span class="k-button k-button-icontext k-grid-add" @click="add()">添加</span>
              <span class="k-button k-button-icontext k-grid-edit" @click="edit(id)">
                @when(edit==id){ 
                  保存
                }.when{ 
                  编辑
                }
              </span>
              <span class="k-button k-button-icontext k-grid-delete" @click="del(id)">删除</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</body>
<script type="text/javascript">
  function data() {
    var data = [];
    for (var i = 0; i < 10; i++) {
      data.push({
        "id": 10000 + data.length,
        "age": "宁波店" + data.length,
        "username": "小小的-" + data.length,
        "address": "西湖区-" + data.length
      })
    }
    return data;
  }

  var resizer, header;
  var grid = new View({
    view: "#grid",
    model: {
      pageX: 0,
      width: 0,
      edit: "edit",
      columns: {
        "id": "档案编号",
        "age": "门店名称",
        "username": "借款人",
        "address": "住址"
      },
      list: data()
    },
    action: {
      add: function () {
        this.list = data();
      },
      edit: function (id) {
        this.edit = this.edit == id ? "edit" : id;
      },
      del: function (id) {
        this.list.splice(id, 1);
      },

      scroll(event) {
        $(this.$view).find(".scrollable").scrollLeft($(event.target).scrollLeft());
      },

      resize(event) {
        let target = event.target;
        header = target;
        if (Math.abs(event.offsetX - $(target).outerWidth(true)) < 8) {
          target.on("mousedown", this.$action.startResize)
          $(this.$view).css("cursor", "col-resize");
        } else {
          target.off("mousedown", this.$action.startResize)
          $(this.$view).css("cursor", "default");
        }
      },

      startResize(event) {
        let target = event.target;
        this.pageX = event.pageX, this.width = $(target).width();
        resizer = $(this.$view).find(`[data-field='${$(target).attr("data-field")}']`);
        target.off("mousemove", this.$action.resize).off("mousedown", this.$action.startResize);
        document.on("mousemove", this.$action.onResize).on("mouseup", this.$action.stopResize);
      },

      onResize(event) {
        var th = event.pageX - this.pageX;
        resizer.width(this.width + th);
      },

      stopResize(event) {
        header.on("mousemove", this.$action.resize);
        document.off("mousemove", this.$action.onResize).off("mouseup", this.$action.stopResize);
      }

    }
  });

  $(`th[data-field]`).each((i, e) => {
    $(e).width($(e).width());
  });
  $(`td[data-row='0']`).each((i, e) => {
    $(e).width($(e).width());
  });
</script>

</html>