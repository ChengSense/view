<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>index</title>
</head>

<body>
</body>

</html>
<script type="text/javascript">
  function observer(target) {
    return new Proxy(target, handler());
  }

  function handler(root) {
    let values = new Map(), caches = new Map();
    return {
      get(parent, prop, proxy) {
        if (prop == "$target") return parent;
        let value = values.get(prop);
        if (value != undefined) return value;
        let path = root ? `${root}.${prop}` : prop;
        value = Reflect.get(parent, prop);
        if (typeof value == "object") value = new Proxy(value, handler(path));
        values.set(prop, value);
        caches.set(prop, new Map());
        return value;
      },
      set(parent, prop, val, proxy) {
        let oldValue = values.get(prop)
        let oldCache = caches.get(prop);
        values.delete(prop);
        caches.delete(prop);
        Reflect.set(parent, prop, val.$target || val);
        let path = root ? `${root}.${prop}` : prop;
        return true;
      }
    }
  }

  let a = {
    user: {
      child: {
        name: "aaaa"
      }
    }
  }
  let b =  observer(a);
  console.log(b.user.child.name)
</script>
</body>

</html>