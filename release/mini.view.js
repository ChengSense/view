var view=function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function a(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}var r=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{|\{([^\{\}]*)\}|\}/g,i=/(@each|@when|\.when)\s*(\((.*)\))?\s*\{/,o=/\{([^\{\}]*)\}/,s=/,\s*\.when/g;function u(e,t){Object.keys(e).forEach(function(n){var c=Reflect.get(e,n);t(c,n)})}var h=function(){function e(t){n(this,e),this.type="TAG",this.name=t,this.attrs={}}return a(e,[{key:"setName",value:function(e){if(""!=e)if(this.name){var t=e.indexOf("="),n=e.slice(0,t),c=e.slice(t+2,e.length-1);Reflect.set(this.attrs,n,c)}else this.name=e}},{key:"react",value:function(){if(this.name.startsWith("/"))return")";if(t=this.name,n=document.createElement(t),new RegExp(/<\/\w+>/).test(n.outerHTML)){var e=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(e)}var t,n,c=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(c,")")}}]),e}(),f=function(){function e(t,c,a){n(this,e),this.type="FUNC",this.name=c,this.attrs={},this.setName(t,a)}return a(e,[{key:"setName",value:function(e,t){if(this.name.startsWith(".when")){e.push(this);var n=this.name.match(i);this.attrs=n[3],this.name=n[1]}else if(this.name.startsWith("}")){var c=t.slice(0,t.indexOf(this.name));e.push(new l(c)),e.push(this)}else if(this.name.startsWith("{")){var a=t.slice(0,t.indexOf(this.name));e.push(new l(a)),e.push(new l(this.name))}else{var r=t.slice(0,t.indexOf(this.name));e.push(new l(r)),e.push(this);var o=this.name.match(i);this.attrs=o[3],this.name=o[1]}}},{key:"react",value:function(){if(this.name.startsWith("}"))return")";var e=JSON.stringify(this.attrs);return'React.createFunction("'.concat(this.name,'",').concat(e)}}]),e}(),l=function(){function e(t){n(this,e),this.type="TEXT",this.name=t}return a(e,[{key:"setName",value:function(e){this.name=e}},{key:"react",value:function(){var e=this.name.replace(/\n/g,"");return'React.createRender("'.concat(e,'",null)')}}]),e}(),p=function(){function e(t,c,a){n(this,e),this.func=a,this.scope=t,this.params=c,this.status=null,this.value=new Map}return a(e,[{key:"when",value:function(e,t){var n=this.value,c=[],a=this.scope;if(null==this.status&&e){this.status=e,d(R.cache,t,a,c),R.cache=new Map;var r=t(this.scope);n.set(a,c),r.forEach(function(e){return m(c,a,e)})}else if(null==this.status&&void 0==e){this.status=e,d(R.cache,t,a,c),R.cache=new Map;var i=t(this.scope);n.set(a,c),i.forEach(function(e){return m(c,a,e)})}return this}},{key:"forEach",value:function(e,t){var n=this,c=this.value,a=[],r=this.params.split(","),i=r[0],o=r[1];return d(R.cache,this.func,this.scope,a),R.cache=new Map,u(e,function(r,s){var u=[],h=Object.create(n.scope.$target);h[o]=s,h=new Proxy(h,function(e,t,n,c){return{get:function(a,r){return n==r?Reflect.get(t,c):"".concat(n,"$")==r?Reflect.get(t,"".concat(c,"$")):"$target"==r?a:a.hasOwnProperty(r)?Reflect.get(a,r):Reflect.get(e,r)},set:function(a,r,i){return n==r?Reflect.set(t,c,i):a.hasOwnProperty(r)?Reflect.set(a,r,i):Reflect.set(e,r,i)}}}(n.scope,e,i,s)),d(R.cache,t,h,u),R.cache=new Map;var f=t(h);c.set(h,u),f.forEach(function(e){return m(u,h,e)}),a.push.apply(u)}),this}},{key:"toString",value:function(){return this.value.join("")}}]),e}();function m(e,t,n){var c=n(t);c instanceof p?e.push.apply(c.value):e.push(c)}var v={createFunction:function(e,t){for(var n=arguments.length,c=new Array(n>2?n-2:0),a=2;a<n;a++)c[a-2]=arguments[a];if("@when"==e)return"\n _scope=>new Render(_scope,null,arguments.callee).when(".concat(w(t),", (_scope) => [").concat(c,"])");if(".when"==e)return"\n .when(".concat(w(t),", (_scope) => [").concat(c,"])");if("@each"==e){var r=t.split(":"),i=r.pop();return"\n _scope=>new Render(_scope,'".concat(r,"',arguments.callee).forEach(").concat(w(i),", (_scope) => [").concat(c,"])")}},createRender:function(e,t){var n;if(t){for(var c=arguments.length,a=new Array(c>2?c-2:0),r=2;r<c;r++)a[r-2]=arguments[r];return'\n _scope=>React.createElement("'.concat(e,'",_scope,arguments.callee,').concat(JSON.stringify(t),",").concat(a,")")}return(n=e.match(o))?"\n _scope=>React.createElement(".concat(w(n[1]),",_scope,arguments.callee,null)"):'\n _scope=>React.createElement("'.concat(e,'",_scope,arguments.callee,null)')},createElement:function(e,t,n,c){if(c){for(var a=document.createElement(e),r=arguments.length,i=new Array(r>4?r-4:0),o=4;o<r;o++)i[o-4]=arguments[o];return i.forEach(function(e){var n=e(t);n instanceof p?n.value.forEach(function(e){return e.forEach(function(e){return a.appendChild(e)})}):a.appendChild(n)}),d(R.cache,n,t,[a]),R.cache=new Map,function(e,t){u(t,function(t,n){if(n.startsWith("@"))!function(e,t,n,c){var a=n.match(/(.*)\((.*)\)/);if(a){var r=a[1],i=Reflect.get(c,r);e.on(t,i,we.model,a[2])}else{var o=Reflect.get(c,n);e.on(t,o,we.model)}}(e,n.slice(1),t,we.action);else{var c=document.createAttribute(n);c.value=t,e.setAttributeNode(c)}})}(a,c),a}var s=document.createTextNode(e);return d(R.cache,n,t,[s]),R.cache=new Map,s}};function d(e,t,n,c){e.forEach(function(e){e&&e.set(t,{scope:n,child:c})})}function w(e){var t,n;if(e)return e.split("").reduce(function(e,c){return!t&&e.match(/\w/)&&(t="_scope.".concat(e)),"'"==n&&"'"==e?(n=null,t=t.concat(c),c):"'"==n?(t=t.concat(c),c):"'"==e?(n=e,t=t.concat(c),c):e.match(/\W/)&&!e.match(/\.|\$|_/)&&c.match(/\w/)&&!c.match(/\d/)?(t=t.concat("_scope.").concat(c),c):(t=t.concat(c),c)}),t}function g(e){return function(e){return new Function("React","return ".concat(e,";"))(v)}(function(e){var t=[],n=null,c=null,a=null;return function(e){return e.split("")}(e).reduce(function(e,i){if("<"==e){var o=i;return a=">",c=new h,o}if('"'==a&&'"'==i){var s=e.concat(i);return c.setName(s.trim()),a=">",""}if(">"==a&&">"==i){var u=e;return a=null,c.setName(u),t.push(c),c=new l,""}if('"'==i){var p=e.concat(i);return a='"',p}return"<"==i?(c.setName(e),t.push(c),i):"TAG"!=c.type||c.name||" "!=i?"TEXT"==c.type&&(n=e.match(r))?(new f(t,n[0],e),i):e.concat(i):(c.setName(e),"")}),t}(e).filter(function(e){return""!=e.name.trim()}).map(function(e){return e.react()}).join().trim()).replace(s,".when").trim()}function y(e,n,c){return new Proxy(e,function e(n,c,a){var r=new Map,i=new Map;return{get:function(o,s,u){if("$target"==s)return o;var h=r.get(s),f=a?"".concat(a,".").concat(s):s;return R.cache.delete(a),R.cache.set(f,i.get(s)),void 0!=h?h:("object"==t(h=Reflect.get(o,s))&&(h=new Proxy(h,e(n,c,f))),r.set(s,h),i.set(s,new Map),R.cache.delete(a),R.cache.set(f,i.get(s)),n.get(f),h)},set:function(e,t,a,o){r.get(t);var s=i.get(t);return r.delete(t),i.delete(t),Reflect.set(e,t,a.$target||a),n.set(s,c),!0}}}(n,c))}function E(e,t,n){this.addEventListener?this.addEventListener(e,function(e){t.forEach(function(t,c){t.forEach(function(t){var a=t?[t]:[];a.push(e),c.apply(n,a)})})},!1):this.attachEvent?this.attachEvent("on".concat(e),function(e){t.forEach(function(t,c){t.forEach(function(t){var a=t?code("[".concat(t,"]"),n):[];a.push(e);var r=Reflect.getPrototypeOf(c),i=Object.assign({},r);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,a)})})}):element["on".concat(e)]=function(e){t.forEach(function(t,c){t.forEach(function(t){var a=t?code("[".concat(t,"]"),n):[];a.push(e);var r=Reflect.getPrototypeOf(c),i=Object.assign({},r);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,a)})})}}Object.assign(Node.prototype,{on:function(e,t,n,c){if(this._manager)if(this._manager.get(e)){var a=this._manager.get(e);a.get(t)?a.get(t).ones(c):a.set(t,[c])}else{var r=new Map;r.set(t,[c]),this._manager.set(e,r),E.call(this,e,r,n)}else{var i=new Map;i.set(t,[c]),this._manager=new Map,this._manager.set(e,i),E.call(this,e,i,n)}return this},off:function(e,t){if(this._manager){var n=this._manager.get(e);if(void 0==n)return;if(n.delete(t),n.size)return;this._manager.delete(e),function(e,t){this.addEventListener?this.removeEventListener(e,t,!1):this.detachEvent?this.detachEvent("on".concat(e),t):element["on".concat(e)]=null}.call(this,e,t)}return this},reappend:function(e){return this.innerHTML="",this.appendChild(e),this},before:function(e){this.parentNode.insertBefore(e,this)},after:function(e){this.nextSibling?this.parentNode.insertBefore(e,this.nextSibling):this.parentNode.appendChild(e)}}),Object.assign(NodeList.prototype,{on:function(e,t){return u(this,function(n){n.on(e,t)}),this},off:function(e,t){return u(this,function(n){n.off(e,t)}),this}});var R={$path:null,cache:new Map},b=function(){function e(t){n(this,e),this.view=t.view,this.model=y(t.model,_,this),this.action=t.action,this.watch=t.watch,this.filter=t.filter,this.creater(t)}return a(e,[{key:"creater",value:function(e){var t,n;this.view=g(this.view),console.warn(this.view),this.node=(t=this.view,n=this,window.we=n,new Function("we","React","Render","return ".concat(t,";\n    "))(n,v,p))(this.model)}}]),e}(),_={set:function(e,t){e.forEach(function(e,t){var n=t(e.scope),c=e.child[0];c&&((n=Array.isArray(n)?n:[n]).forEach(function(t){var n=t(e.scope);n instanceof p?n.value.forEach(function(e){return e.forEach(function(e){return c.appendChild(e)})}):c.appendChild(n),c.parentNode.appendChild(n)}),e.child.forEach(function(e){return e.parentNode.removeChild(e)}))})},get:function(e){}};return window.View=b,e.React=v,e.Render=p,e.View=b,e.global=R,e.query=function(e){try{return document.querySelectorAll(e)}catch(n){var t=document.createElement("div");return t.innerHTML=e.trim(),t.childNodes}},e}({});
