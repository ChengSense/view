var view=function(t){"use strict";function e(t){"@babel/helpers - typeof";return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function a(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}var r=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{|\{([^\{\}]*)\}|\}/g,i=/(@each|@when|\.when)\s*(\((.*)\))?\s*\{/,o=/\{([^\{\}]*)\}/,s=/,\s*\.when/g;function u(t,e){Object.keys(t).forEach(function(n){var c=Reflect.get(t,n);e(c,n)})}var h=function(){function t(e){n(this,t),this.type="TAG",this.name=e,this.attrs={}}return a(t,[{key:"setName",value:function(t){if(""!=t)if(this.name){var e=t.indexOf("="),n=t.slice(0,e),c=t.slice(e+2,t.length-1);Reflect.set(this.attrs,n,c)}else this.name=t}},{key:"react",value:function(){if(this.name.startsWith("/"))return")";if(e=this.name,n=document.createElement(e),new RegExp(/<\/\w+>/).test(n.outerHTML)){var t=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(t)}var e,n,c=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(c,")")}}]),t}(),f=function(){function t(e,c,a){n(this,t),this.type="FUNC",this.name=c,this.attrs={},this.setName(e,a)}return a(t,[{key:"setName",value:function(t,e){if(this.name.startsWith(".when")){t.push(this);var n=this.name.match(i);this.attrs=n[3],this.name=n[1]}else if(this.name.startsWith("}")){var c=e.slice(0,e.indexOf(this.name));t.push(new l(c)),t.push(this)}else if(this.name.startsWith("{")){var a=e.slice(0,e.indexOf(this.name));t.push(new l(a)),t.push(new l(this.name))}else{var r=e.slice(0,e.indexOf(this.name));t.push(new l(r)),t.push(this);var o=this.name.match(i);this.attrs=o[3],this.name=o[1]}}},{key:"react",value:function(){if(this.name.startsWith("}"))return")";var t=JSON.stringify(this.attrs);return'React.createFunction("'.concat(this.name,'",').concat(t)}}]),t}(),l=function(){function t(e){n(this,t),this.type="TEXT",this.name=e}return a(t,[{key:"setName",value:function(t){this.name=t}},{key:"react",value:function(){var t=this.name.replace(/\n/g,"");return'React.createRender("'.concat(t,'",null)')}}]),t}(),p=function(){function t(e,c,a){n(this,t),this.func=a,this.scope=e,this.params=c,this.status=null,this.value=new Map}return a(t,[{key:"when",value:function(t,e){var n=this.value,c=[],a=this.scope;return null==this.status&&t?(this.status=t,w(b.cache,this.func,a,c),b.cache=new Map,n.set(a,c),e.forEach(function(t){return v(c,a,t)})):null==this.status&&void 0==t&&(this.status=t,w(b.cache,this.func,a,c),b.cache=new Map,n.set(a,c),e.forEach(function(t){return v(c,a,t)})),this}},{key:"forEach",value:function(t,e){var n=this,c=this.value,a=[],r=this.params.split(","),i=r[0],o=r[1];return w(b.cache,this.func,this.scope,a),b.cache=new Map,u(t,function(r,s){var u=[],h=Object.create(n.scope.$target);h[o]=s,h=new Proxy(h,function(t,e,n,c){return{get:function(a,r){return n==r?Reflect.get(e,c):"".concat(n,"$")==r?Reflect.get(e,"".concat(c,"$")):"$target"==r?a:a.hasOwnProperty(r)?Reflect.get(a,r):Reflect.get(t,r)},set:function(a,r,i){return n==r?Reflect.set(e,c,i):a.hasOwnProperty(r)?Reflect.set(a,r,i):Reflect.set(t,r,i)}}}(n.scope,t,i,s)),b.cache=new Map,c.set(h,u),e.forEach(function(t){return v(u,h,t)}),a.push.apply(u)}),this}},{key:"toString",value:function(){return this.value.join("")}}]),t}();function v(t,e,n){var c=n(e,n);c instanceof p?t.push.apply(c.value):t.push(c)}var m={createFunction:function(t,e){for(var n=arguments.length,c=new Array(n>2?n-2:0),a=2;a<n;a++)c[a-2]=arguments[a];if("@when"==t)return"\n (_scope,func)=>new Render(_scope,null,func).when(".concat(y(e),", [").concat(c,"])");if(".when"==t)return"\n .when(".concat(y(e),", [").concat(c,"])");if("@each"==t){var r=e.split(":"),i=r.pop();return"\n (_scope,func)=>new Render(_scope,'".concat(r,"',func).forEach(").concat(y(i),", [").concat(c,"])")}},createRender:function(t,e){var n;if(e){for(var c=arguments.length,a=new Array(c>2?c-2:0),r=2;r<c;r++)a[r-2]=arguments[r];return'\n (_scope,func)=>React.createElement("'.concat(t,'",_scope,func,').concat(JSON.stringify(e),",").concat(a,")")}return(n=t.match(o))?"\n (_scope,func)=>React.createElement(".concat(y(n[1]),",_scope,func,null)"):'\n (_scope,func)=>React.createElement("'.concat(t,'",_scope,func,null)')},createElement:function(t,e,n,c){if(c){var a=document.createElement(t);w(b.cache,n,e,[a]),b.cache=new Map;for(var r=arguments.length,i=new Array(r>4?r-4:0),o=4;o<r;o++)i[o-4]=arguments[o];return i.forEach(function(t){var n=t(e,t);n instanceof p?n.value.forEach(function(t){return t.forEach(function(t){return a.appendChild(t)})}):a.appendChild(n)}),function(t,e){u(e,function(e,n){if(n.startsWith("@"))!function(t,e,n,c){var a=n.match(/(.*)\((.*)\)/);if(a){var r=a[1],i=Reflect.get(c,r);t.on(e,i,we.model,a[2])}else{var o=Reflect.get(c,n);t.on(e,o,we.model)}}(t,n.slice(1),e,we.action);else{var c=document.createAttribute(n);c.value=e,t.setAttributeNode(c)}})}(a,c),a}var s=document.createTextNode(t);return w(b.cache,n,e,[s]),b.cache=new Map,s}};function w(t,e,n,c){t.forEach(function(t){var a=t.get(e);a?a.child.push.apply(c):t.set(e,{scope:n,child:c})})}function d(t,e){return window.we=e,new Function("we","React","Render","return ".concat(t,";\n    "))(e,m,p)}function y(t){var e,n;if(t)return t.split("").reduce(function(t,c){return!e&&t.match(/\w/)&&(e="_scope.".concat(t)),"'"==n&&"'"==t?(n=null,e=e.concat(c),c):"'"==n?(e=e.concat(c),c):"'"==t?(n=t,e=e.concat(c),c):t.match(/\W/)&&!t.match(/\.|\$|_/)&&c.match(/\w/)&&!c.match(/\d/)?(e=e.concat("_scope.").concat(c),c):(e=e.concat(c),c)}),e}function g(t){return function(t){return new Function("React","return ".concat(t,";"))(m)}(function(t){var e=[],n=null,c=null,a=null;return function(t){return t.split("")}(t).reduce(function(t,i){if("<"==t){var o=i;return a=">",c=new h,o}if('"'==a&&'"'==i){var s=t.concat(i);return c.setName(s.trim()),a=">",""}if(">"==a&&">"==i){var u=t;return a=null,c.setName(u),e.push(c),c=new l,""}if('"'==i){var p=t.concat(i);return a='"',p}return"<"==i?(c.setName(t),e.push(c),i):"TAG"!=c.type||c.name||" "!=i?"TEXT"==c.type&&(n=t.match(r))?(new f(e,n[0],t),i):t.concat(i):(c.setName(t),"")}),e}(t).filter(function(t){return""!=t.name.trim()}).map(function(t){return t.react()}).join().trim()).replace(s,".when").trim()}function E(t,n,c){return new Proxy(t,function t(n,c,a){var r=new Map,i=new Map;return{get:function(o,s,u){if("$target"==s)return o;if(!o.hasOwnProperty(s)&&Reflect.has(o,s))return Reflect.get(o,s);var h=r.get(s),f=a?"".concat(a,".").concat(s):s;return b.cache.delete(a),b.cache.set(f,i.get(s)),void 0!=h?h:("object"==e(h=Reflect.get(o,s))&&(h=new Proxy(h,t(n,c,f))),r.set(s,h),i.set(s,new Map),b.cache.delete(a),b.cache.set(f,i.get(s)),n.get(f),h)},set:function(t,o,s,u){if(!t.hasOwnProperty(o)&&Reflect.has(t,o))return Reflect.set(t,o,s);var h=r.get(o),f=i.get(o);r.delete(o),i.delete(o),Reflect.set(t,o,s.$target||s);var l=u[o];!function t(n,c,a,r){"object"==e(n)&&"object"==e(c)&&Object.keys(c).forEach(function(i){b.cache=new Map;var o=n[i],s=b.cache;b.cache=new Map;var u=c[i],h=b.cache;"object"!=e(o)&&"object"!=e(u)&&a.set(h,s,r),t(o,u,a,r)})}(l,h,n,c);var p=a?"".concat(a,".").concat(o):o;return n.set(new Map([[p,f]]),new Map([[p,i.get(o)]]),c),!0}}}(n,c))}function R(t,e,n){this.addEventListener?this.addEventListener(t,function(t){e.forEach(function(e,c){e.forEach(function(e){var a=e?[e]:[];a.push(t),c.apply(n,a)})})},!1):this.attachEvent?this.attachEvent("on".concat(t),function(t){e.forEach(function(e,c){e.forEach(function(e){var a=e?code("[".concat(e,"]"),n):[];a.push(t);var r=Reflect.getPrototypeOf(c),i=Object.assign({},r);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,a)})})}):element["on".concat(t)]=function(t){e.forEach(function(e,c){e.forEach(function(e){var a=e?code("[".concat(e,"]"),n):[];a.push(t);var r=Reflect.getPrototypeOf(c),i=Object.assign({},r);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,a)})})}}Object.assign(Node.prototype,{on:function(t,e,n,c){if(this._manager)if(this._manager.get(t)){var a=this._manager.get(t);a.get(e)?a.get(e).ones(c):a.set(e,[c])}else{var r=new Map;r.set(e,[c]),this._manager.set(t,r),R.call(this,t,r,n)}else{var i=new Map;i.set(e,[c]),this._manager=new Map,this._manager.set(t,i),R.call(this,t,i,n)}return this},off:function(t,e){if(this._manager){var n=this._manager.get(t);if(void 0==n)return;if(n.delete(e),n.size)return;this._manager.delete(t),function(t,e){this.addEventListener?this.removeEventListener(t,e,!1):this.detachEvent?this.detachEvent("on".concat(t),e):element["on".concat(t)]=null}.call(this,t,e)}return this},reappend:function(t){return this.innerHTML="",this.appendChild(t),this},before:function(t){this.parentNode.insertBefore(t,this)},after:function(t){this.nextSibling?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.appendChild(t)}}),Object.assign(NodeList.prototype,{on:function(t,e){return u(this,function(n){n.on(t,e)}),this},off:function(t,e){return u(this,function(n){n.off(t,e)}),this}});var b={$path:null,cache:new Map},O=function(){function t(e){n(this,t),this.view=e.view,this.model=E(e.model,N,this),this.action=e.action,this.watch=e.watch,this.filter=e.filter,this.creater(e)}return a(t,[{key:"creater",value:function(t){this.view=g(this.view),console.warn(this.view);var e=d(this.view,this);this.node=d(this.view,this)(this.model,e)}}]),t}(),N={set:function(t,e,n){t.forEach(function(t){t.forEach(function(t,e){var n=t.child;t.child=[];var c=n[0],a=e(t.scope,e);c&&((a=Array.isArray(a)?a:[a]).forEach(function(e){e instanceof p?e.value.forEach(function(e){return e.forEach(function(e){t.child.push(e),c.before(e)})}):(t.child.push(e),c.before(e))}),n.forEach(function(t){return t.parentNode.removeChild(t)}))})})},get:function(t){}};return window.View=O,t.React=m,t.Render=p,t.View=O,t.global=b,t.query=function(t){try{return document.querySelectorAll(t)}catch(n){var e=document.createElement("div");return e.innerHTML=t.trim(),e.childNodes}},t}({});
