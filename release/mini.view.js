var view=function(e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function c(e,n,t){for(;e.length;){var o=e[0];if(n.call(t,o,e))break}}function i(e,n,t){if(e)return t=t||e,Object.keys(e).every(function(o){var c=e[o];return!n.call(c,c,o,t)}),t}function r(e,n,t){if(e)if(e.hasOwnProperty("$index"))for(var o=e.$index;o<e.$length;o++)n.call(t,e[o],o);else Object.keys(e).forEach(function(o){n.call(t,e[o],o)})}function a(e){return[].slice.call(e)}function s(e,n){var t=e.prototype||e.__proto__;for(var o in n)t[o]=n[o];return e}function l(e){return null==e||void 0==e||""==e}function d(e){try{return document.querySelectorAll(e)}catch(t){var n=document.createElement("div");return n.innerHTML=e.trim(),n.childNodes}}s(Array,{remove:function(e){var n=this.indexOf(e);return n>-1&&this.splice(n,1),this},replace:function(e,n){var t=this.indexOf(e);t>-1&&this.splice(t,1,n)},splices:function(e){this.splice.apply(this,e)},has:function(e){return this.indexOf(e)>-1},ones:function(e){this.has(e)||this.push(e)}}),s(Node,{on:function(e,n){return this.addEventListener(e,n),this},reappend:function(e){return i(a(this.childNodes),function(e){e.parentNode.removeChild(e)}),this.appendChild(e),this},before:function(e){this.parentNode.insertBefore(e,this)},after:function(e){this.nextSibling?this.parentNode.insertBefore(e,this.nextSibling):this.parentNode.appendChild(e)}}),s(NodeList,{on:function(e,n){i(this,function(t){t.on(e,n)})},off:function(e,n){i(this,function(t){t.off(e,n)})}});var h=/((@each|@when|\.when)\s*\((.*)\)\s*\{|\{\s*([^\{\}]*)\s*\}|\s*\}\s*|\.when\s*\{)/g,u=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{/,p=/(@each)\s*\((.*)\)\s*\{/g,f=/(@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{/g,v=/\.when\s*\((.*)\)\s*\{|\.when\s*\{/g,m=/@when/g,w=/\{\s*@?([^\{\}]*)\s*\}/,N=/\{\s*([^\{\}]*)\s*\}/g,g=/\{\s*\s*@([^\{\}]*)\s*\}/,y=/(^\s*\}\s*$)/,b=/(\w+)((\.\w+)|(\[(.+)\]))*/g,$=/^@(.*)/;function E(e,n){try{return q.$path=void 0,q.$cache=void 0,V(e=e.replace(w,"$1"))(n)}catch(e){return}}function x(e,n){try{return V(e="'"+e.replace(N,"'+($1)+'")+"'")(n)}catch(e){return}}function V(e){return new Function("_scope","with (_scope) {\n       return "+e+";\n    }")}function C(e){try{return e.replace(/(\w+)\.?/g,"['$1']")}catch(e){return}}function O(e,n,t){Object.defineProperty(e,n,{get:function(){return new Function("scope","\n        return scope"+C(t)+";\n        ")(e)},set:function(n){new Function("scope","val","\n        scope"+C(t)+"=val;\n        ")(e,n)}})}function j(e,n,t,o,i){function s(e,n){r(e.attributes,function(e){var t=function(e,n,t){return{node:e,clas:t,children:[],scope:n,childNodes:[]}}(e,n,e.cloneNode());new RegExp(N).test(e.nodeValue)&&(y.attrExpress(e,n,t),e.nodeValue=x(e.nodeValue,n)),function(e,n){e.name.replace($,function(t){t=t.replace($,"$1");var o=e.ownerElement;o.on(t,function(t){var o,c,i,r,a,s;o=e.nodeValue,c=n,i=t,r=o.toString().match(/\(([^)]*)\)/),a=o.toString().replace(r[0],""),(s=E("["+r[1]+"]",c)).push(i),E(a,c.$action).apply(c,s)})})}(e,n)})}function d(e,n,t,o){var c=void 0;s(e,n),new RegExp(g).test(e.nodeValue)?(!function(e,n,t,o){var c=document.createComment("component");e.parentNode.replaceChild(c,e),t.scope=n,t.resolver="component",t.content=o,t.childNodes.push({node:c,children:[],content:t,childNodes:[]})}(e,n,t,o),S.component(t,i)):(c=new RegExp(w).exec(e.nodeValue))&&(y.express(e,n,t,c[0]),e.nodeValue=E(c[1],n))}function h(e){if(e)return new RegExp(v).test(e.clas.nodeValue)}var y={attrEach:function(e,n,t,o){void 0!=q.$cache&&(t.resolver="each",t.content=o,t.scope=n,t.node=e,A(t,i,q.$cache))},each:function(e,n,t,o){void 0!=q.$cache&&(t.resolver="each",t.content=o,t.scope=n,t.node=e,A(t,i,q.$cache))},when:function(e,n,t){var o=t.clas.nodeValue,c=new RegExp(f).exec(o);if(c){var i=c.pop();t.resolver="when",t.scope=n,t.node=e,V(i,n,t)}},express:function(e,n,t,o){t.resolver="express",t.scope=n,t.node=e,V(o,n,t)},attrExpress:function(e,n,t){t.clas.nodeValue.replace(N,function(o){t.resolver="express",t.scope=n,t.node=e,V(o,n,t)}),"value"==t.clas.name&&function(e,n){var t,o=e.ownerElement;if(o._express=e.nodeValue.replace(w,"$1"),o.on("change",t=function(){new Function("scope","\n        scope"+C(o._express)+"='"+o.value.replace(/(\'|\")/g,"\\$1")+"';\n        ")(n)}),"SELECT"==o.nodeName){var c=E(o._express,n);l(c)?t():o.value=c}}(e,n)}};function V(e,n,t){e.replace(b,function(e){E(e,n),void 0!=q.$cache&&A(t,i,q.$cache)})}function j(e,n){return{node:e,clas:n.clas,children:n.children,scope:n.scope,childNodes:[]}}function k(e,n,t){var o=document.createComment("each:"+q.$path);return n.appendChild(o),{node:e,clas:t.clas,children:t.children,scope:t.scope,childNodes:[{node:o,clas:t.clas,children:[],scope:t.scope,childNodes:[]}]}}!function e(n,t,o,i){c(o,function(o,s){if(1==o.clas.nodeType)if(o.clas.hasAttribute("each")){var l=(x=o.clas.getAttribute("each").split(":")).shift().trim(),v=x.pop().trim(),w=x.shift(),N=E(v,t),g=k(null,n,o);i.childNodes.push(g),y.attrEach(null,t,g,i,N),r(N,function(c,r){var s=Object.create(t||{});O(s,l,q.$path),w&&(s[w.trim()]=r.toString());var h=o.clas.cloneNode();h.removeAttribute("each"),n.appendChild(h);var u=j(h,o);g.childNodes.push(u),e(h,s,a(o.children),u),d(h,s,u,i)})}else if(/(CODE|SCRIPT)/.test(o.clas.nodeName)){var b=o.clas.cloneNode(!0);n.appendChild(b);var $=j(b,o);i.childNodes.push($)}else b=o.clas.cloneNode(),n.appendChild(b),$=j(b,o),i.childNodes.push($),e(b,t,a(o.children),$),d(b,t,$,i);else if(p.test(o.clas.nodeValue)){var x;l=(x=o.clas.nodeValue.replace(p,"$2").split(":")).shift().trim(),v=x.pop().trim(),w=x.shift(),N=E(v,t),g=k(null,n,o),i.childNodes.push(g),y.each(null,t,g,i,N);var V=a(o.children);r(N,function(c,i){var r=Object.create(t||{});O(r,l,q.$path),w&&(r[w.trim()]=i.toString());var s=j(null,o);g.childNodes.push(s),e(n,r,a(V),s)})}else{if(f.test(o.clas.nodeValue)){var C=E(o.clas.nodeValue.replace(f,"$2"),t);return(g=function(e,n,t,o,c){if(new RegExp(m).test(t.clas.nodeValue)){var i=document.createComment("when:"+q.$path);n.appendChild(i),o.childNodes.push(o={node:e,clas:t.clas,children:[],scope:t.scope,content:o,childNodes:[{node:i,clas:t.clas,children:[],scope:t.scope,childNodes:[]}]}),y.when(null,c,o)}return o}(null,n,o,i,t)).children.push(s.shift()),C?(y.when(null,t,g,i),c(s,function(e,n){if(!h(e))return!0;g.children.push(n.shift())}),c(a(o.children),function(o,c){if(1==o.clas.nodeType||u.test(o.clas.nodeValue))e(n,t,c,g);else{var i=o.clas.cloneNode();n.appendChild(i);var r=j(i,o);g.childNodes.push(r),d(i,t,r,g)}c.shift()})):void 0==C?(y.when(null,t,g,i),c(a(o.children),function(o,c){if(1==o.clas.nodeType||u.test(o.clas.nodeValue))e(n,t,c,g);else{var i=o.clas.cloneNode();n.appendChild(i);var r=j(i,o);g.childNodes.push(r),d(i,t,r,g)}c.shift()})):h(s[0])&&e(n,t,s,g),h(o)}b=o.clas.cloneNode(),n.appendChild(b),$=j(b,o),i.childNodes.push($),d(b,t,$,i)}s.shift()})}(e,n,t,o)}var S={view:function(e,n,t,o,c){try{var i=document.createDocumentFragment();new j(i,t,a(n.children),o,c),o.children=n.children,o.clas=n.clas,e.reappend(i)}catch(e){console.log(e)}},component:function(e,n){try{var t=E(e.clas.nodeValue,e.scope),o=q.$cache;if(e.path=[q.$path],l(t))return;s=t.model,d=e.scope,s.__proto__=d;var c=_(e.childNodes),i=e.content.childNodes;P(e.childNodes);var r=new M({view:t.component,model:t.model,action:t.action}),a=function(e,n,t){var o=document.createComment("component:"+n.path);return e.before(o),t.content.node=t.view,{clas:n.clas,children:[t.node],scope:n.scope,resolver:n.resolver,content:n.content,childNodes:[{node:o,children:[],scope:n.scope,childNodes:[]},t.content]}}(c,e,r);A(a,n,o),i.replace(e,a),c.parentNode&&c.parentNode.replaceChild(r.view,c)}catch(e){console.log(e)}var s,d},when:function(e,n){try{var t=_(e.childNodes),o=document.createDocumentFragment(),c=e.content.childNodes;P(e.childNodes),new j(o,e.scope,a(e.children),e.content,n),c.replace(e,c.pop()),t.parentNode&&t.parentNode.replaceChild(o,t)}catch(e){console.log(e)}},each:function(e,n){try{var t=_(e.childNodes),o=document.createDocumentFragment(),c=e.content.childNodes;P(e.childNodes),new j(o,e.scope,[e],e.content,n),c.replace(e,c.pop()),t.parentNode&&t.parentNode.replaceChild(o,t)}catch(e){console.log(e)}},arrayEach:function(e,n,t,o){try{var c=function e(n,t){try{return i(n,function(n){if(n.node&&n.node.parentNode)return t=n.node;t=e(n.childNodes)}),t}catch(e){console.log(e)}}([e.childNodes[t]]),r=document.createDocumentFragment(),s={clas:e.clas,children:e.children,scope:e.scope},l={childNodes:[],children:[]};new j(r,e.scope,[s],l,n),r.removeChild(r.childNodes[0]);var d=a(l.childNodes[0].childNodes);d.splice(0,1,t+1,0),e.childNodes.splices(d),o.remove(l.childNodes[0]),c.parentNode&&c.after(r)}catch(e){console.log(e)}},express:function(e,n){try{e.node.nodeValue=x(e.clas.nodeValue,e.scope),A(e,n,q.$cache),"value"==e.node.name&&(e.node.ownerElement.value=e.node.nodeValue)}catch(e){console.log(e)}},attribute:function(e,n){try{var t=document.createAttribute(x(e.clas.name,scope));A(e,n,q.$cache),t.nodeValue=e.clas.nodeValue,e.node.ownerElement.setAttributeNode(t),e.node.ownerElement.removeAttributeNode(e.node)}catch(e){console.log(e)}}},k=function(e,n,t,o,c){try{e.forEach(function(e,i){e.forEach(function(r){T[r.resolver](r,n,t,o,c,i,e)})}),s(o,{$change:!1})}catch(e){console.error(e)}},T={each:function(e,n,t,o,c,i,r){try{var a=o.length;if(c>0&&o.$change)P(e.childNodes.splice(a+1)),S.arrayEach(e,i,e.childNodes.length-1,r);else if(c>0){P(e.childNodes.splice(n+1,t)),o.$index=n,o.$length=n+c,S.arrayEach(e,i,n,r)}else if(o.$change){P(e.childNodes.splice(a+1))}else{P(e.childNodes.splice(n+1,t))}}catch(e){console.error(e)}}};function A(e,n,t){var o=t.get(n);o?o.ones(e):t.set(n,[e])}function _(e,n){try{return i(e,function(e){if(e.node&&e.node.parentNode)return n=e.node,e.node=null,n;n=_(e.childNodes)}),n}catch(e){console.log(e)}}function P(e){e.forEach(function(e){if(e.node&&e.node.parentNode)return e.node.parentNode.removeChild(e.node);e.childNodes&&P(e.childNodes)})}function R(e,t,o){function c(t,o,c){t instanceof M||"object"==(void 0===t?"undefined":n(t))&&(Array.isArray(t)&&function(n,t){function o(){return new Function("scope","\n        return scope"+C(t)+";\n        ")(e),q.$cache}a.forEach(function(c){var r=Array.prototype[c];switch(c){case"shift":Object.defineProperty(n,c,{writable:!0,value:function(){var e=r.apply(this,arguments);return k(o(),0,1,this),e}});break;case"pop":Object.defineProperty(n,c,{writable:!0,value:function(){var e=r.apply(this,arguments);return k(o(),this.length,1,this),e}});break;case"splice":Object.defineProperty(n,c,{writable:!0,value:function(e,n){if(0<this.length){e=new Number(e);var c=this.length,a=r.apply(this,arguments);if(e<c&&arguments.length>2){var s=c;for(this.$index=c,this.$length=this.length;s<this.$length;)i(this,s++,t)}else if(arguments.length>2){var s=e=this.$index=c;for(this.$length=this.length;s<this.$length;)i(this,s++,t)}return k(o(),e,n,this,arguments.length-2),delete this.$index,delete this.$length,a}}});break;case"push":Object.defineProperty(n,c,{writable:!0,value:function(e){var n=this.length,c=r.call(this,e);for(this.$index=n,this.$length=this.length;n<this.length;)i(this,n++,t);return k(o(),this.$index,0,this,1),delete this.$index,delete this.$length,c}});break;default:Object.defineProperty(n,c,{writable:!0,value:function(){var o=r.apply(this,arguments);return new Function("scope","val","\n        scope"+C(t)+"=val;\n        ")(e,n),o}})}})}(t,o),Object.keys(t).forEach(function(e){i(t,e,o,c)}))}function i(e,t,o,i){var a,s=e[t];void 0!=i&&(a=i[t]);var l=o?o+"."+t:t;s instanceof M?r(e,t,l,a):"object"==(void 0===s?"undefined":n(s))?(c(s,l,a),r(e,t,l,a)):r(e,t,l,a)}function r(n,t,o,i){var r=n[t],a=new Map;Object.defineProperty(n,t,{get:function(){return F.publish(e,"get",[o]),q.$cache=a,r},set:function(t){var i=r,s=a;a=new Map,c(r=t,o,i),F.publish(e,"set",[i,s,n])}})}var a=["shift","push","pop","splice","unshift","reverse"];F.subscribe(e,"set",t),F.subscribe(e,"get",o),c(e)}var F=new(function(){function e(){t(this,e),this.map=new Map}return o(e,[{key:"publish",value:function(e,n,t){var o=this.map.get(e);if(o){var c=o.get(n);c?c.data.push(t):o.set(n,{data:[t],queue:[]})}else{var i=new Map;i.set(n,{data:[i],queue:[]}),this.map.set(e,i)}this.notify(o.get(n))}},{key:"notify",value:function(e){if(e)for(var n=function(){var n=e.data.shift();e.queue.forEach(function(e){e(n[0],n[1],n[2])})};e.data.length;)n();else this.map.forEach(function(e){e.forEach(function(e){for(var n=function(){var n=e.data.shift();e.queue.forEach(function(e){e(n[0],n[1],n[2])})};e.data.length;)n()})})}},{key:"subscribe",value:function(e,n,t){var o=this.map.get(e);if(o){var c=o.get(n);c?c.queue.push(t):o.set(n,{data:[],queue:[t]})}else{var i=new Map;i.set(n,{data:[],queue:[t]}),this.map.set(e,i)}}}]),e}());var q={$path:void 0},M=function(){function e(n){t(this,e),this.content={childNodes:[],children:[]},this.model=n.model,this.action=n.action,R(n.model,function(e,n,t){!function(e,n){e.forEach(function(e,t){a(e).forEach(function(o){!function e(n,t){try{return n.every(function(n){if(n.node){var o=n.node.ownerElement||n.node;return t=document.body.contains(o),!1}t=e(n.childNodes)}),t}catch(e){console.log(e)}}([o])?e.remove(o):(s(n,{$change:!0}),S[o.resolver](o,t))})})}(n,t)},function(e){q.$path=e}),n.view?this.view(n):this.component(n)}return o(e,[{key:"view",value:function(e){var n=d(e.view),t=function e(n,t){var o=t||[];return c(n,function(t){if(n.shift(),new RegExp(y).test(t.nodeValue))return!0;var c={clas:t.cloneNode(!0),children:[]};3==t.nodeType&&""==t.nodeValue.trim()||o.push(c),1==t.nodeType?e(a(t.childNodes),c.children):new RegExp(u).test(t.nodeValue)&&e(n,c.children)}),o}(function e(n){return i(n,function(n){n.childNodes[0]&&!/(CODE|SCRIPT)/.test(n.nodeName)&&e(a(n.childNodes)),3==n.nodeType&&n.nodeValue.replace(h,function(e){var t=n.nodeValue.split(e);n.parentNode.insertBefore(document.createTextNode(t[0]),n),n.parentNode.insertBefore(document.createTextNode(e.trim()),n),n.nodeValue=n.nodeValue.replace(t[0],"").replace(e,"")})}),n}(a(n)))[0];this.node=t,this.view=n[0],e.model.$action=e.action,S.view(this.view,t,e.model,this.content,this)}},{key:"component",value:function(e){var n=d(e.component);this.view=n[0],this.view.parentNode.removeChild(this.view),this.component=this.view.outerHTML}}]),e}();return window.View=M,window.Router=function(e,n){var t=/^:/,o=/^\/(.+)/,c=void 0,i=void 0,r=void 0;this.redreact=h;var a,s=!((a=window.navigator.userAgent).indexOf("compatible")>-1&&a.indexOf("MSIE")>-1||a.indexOf("Trident")>-1||a.indexOf("Edge")>-1)&&window.history&&"pushState"in window.history;function l(e){for(r=Object.keys(n);r.length;){c=r.shift(),i={};var t=c.replace(o,"$1");if(d(t=t.split("/"),e.split("/")))return{component:n[c].component,router:n[c].router,action:n[c].action,after:n[c].after,params:i,path:e}}}function d(e,n){for(;n.length;){var o=e.shift(),c=n.shift();if(c!=o){if(!t.test(o))return!1;o=o.replace(t,""),i[o]=c}}return!0}function h(e){var n=window.location.pathname;window.location.href=n+"#"+e}function u(n){var t=l(window.location.hash.replace(/^#\/?/,""));t?(t.action(t.params),e.model[t.router]=t.component,t.after&&t.after()):void 0!=n&&"load"!=n.type||h("")}window.addEventListener("load",u,u()),window.addEventListener(s?"popstate":"hashchange",u,!1)},window.clone=function e(t){if(Array.isArray(t))return t.map(e);if(t&&"object"===(void 0===t?"undefined":n(t))){var o={};for(var c in t)o[c]=e(t[c]);return o}return t},e.global=q,e.View=M,e}({});
