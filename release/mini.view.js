var view=function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}var a=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{|\{([^\{\}]*)\}|\}/g,c=/(@each|@when|\.when)\s*(\((.*)\))?\s*\{/,o=/\{([^\{\}]*)\}/,s=/,\s*\.when/g;function u(t,e){t.every(function(t,n){return!e(t,n)})}var h=function(){function t(e){n(this,t),this.type="TAG",this.name=e,this.attrs={}}return i(t,[{key:"setName",value:function(t){if(""!=t)if(this.name){var e=t.indexOf("="),n=t.slice(0,e),r=t.slice(e+2,t.length-1);Reflect.set(this.attrs,n,r)}else this.name=t}},{key:"react",value:function(){if(this.name.startsWith("/"))return")";if(e=this.name,n=document.createElement(e),new RegExp(/<\/\w+>/).test(n.outerHTML)){var t=JSON.stringify(this.attrs);return'\nReact.createRender("'.concat(this.name,'",').concat(t)}var e,n,r=JSON.stringify(this.attrs);return'\nReact.createRender("'.concat(this.name,'",').concat(r,")")}}]),t}(),f=function(){function t(e,r,i){n(this,t),this.type="FUNC",this.name=r,this.attrs={},this.setName(e,i)}return i(t,[{key:"setName",value:function(t,e){if(this.name.startsWith(".when")){t.push(this);var n=this.name.match(c);this.attrs=n[3],this.name=n[1]}else if(this.name.startsWith("}")){var r=e.slice(0,e.indexOf(this.name));t.push(new l(r)),t.push(this)}else if(this.name.startsWith("{")){var i=e.slice(0,e.indexOf(this.name));t.push(new l(i)),t.push(new l(this.name))}else{var a=e.slice(0,e.indexOf(this.name));t.push(new l(a)),t.push(this);var o=this.name.match(c);this.attrs=o[3],this.name=o[1]}}},{key:"react",value:function(){if(this.name.startsWith("}"))return")";var t=JSON.stringify(this.attrs);return'\nReact.createFunction("'.concat(this.name,'",').concat(t)}}]),t}(),l=function(){function t(e){n(this,t),this.type="TEXT",this.name=e}return i(t,[{key:"setName",value:function(t){this.name=t}},{key:"react",value:function(){var t=this.name.replace(/\n/g,"");return'\nReact.createRender("'.concat(t,'",null)')}}]),t}(),v=function(){function t(){n(this,t),this.status=null,this.value=null}return i(t,[{key:"when",value:function(t,e){return null==this.status&&t?(this.status=t,this.value=e()):null==this.status&&void 0==t&&(this.status=t,this.value=e()),this}},{key:"forEach",value:function(t,e){var n=this;return this.value=[],Object.keys(t).forEach(function(r){var i=e(t[r],r);n.value.push(i.join(""))}),this}},{key:"toString",value:function(){return this.value.join("")}}]),t}(),m={createFunction:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if("@when"==t)return"\nnew Render().when(".concat(e,", () => [").concat(r,"])");if(".when"==t)return"\n.when(".concat(e,", () => [").concat(r,"])");if("@each"==t){var a=e.split(":"),c=a.pop();return"\nnew Render().forEach(".concat(c,", (").concat(a,") => [").concat(r,"])")}},createRender:function(t,e){var n,r,i;if(e){for(var a=arguments.length,c=new Array(a>2?a-2:0),s=2;s<a;s++)c[s-2]=arguments[s];return'\nReact.createElement("'.concat(t,'",').concat((r=e,i=[],Object.keys(r).forEach(function(t){var e=r[t],n="`".concat(e.replace(o,"${$1}"),"`");i.push('"'.concat(t,'":').concat(n))}),"{".concat(i,"}")),",").concat(c,")")}return(n=t.match(o))?"\nReact.createElement(".concat(n[1],",null)"):'\nReact.createElement("'.concat(t,'",null)')},createElement:function(t,e){if(e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return"<".concat(t," ").concat((a=e,c=[],Object.keys(a).forEach(function(t){var e=a[t];c.push("".concat(t,'="').concat(e,'"'))}),c.join(" ")),">").concat(r.join(""),"</").concat(t,">")}return"".concat(t);var a,c}};function p(t,e){var n=Object.keys(e);return new Function("scope","React","Render","let {".concat(n,"}=scope;\n     return ").concat(t,";\n    "))(e,m,v)}function d(t){var e=function(t){var e=[],n=null,r=null,i=null;return function(t){return t.split("")}(t).reduce(function(t,c){if("<"==t){var o=c;return i=">",r=new h,o}if('"'==i&&'"'==c){var s=t.concat(c);return r.setName(s.trim()),i=">",""}if(">"==i&&">"==c){var u=t;return i=null,r.setName(u),e.push(r),r=new l,""}if('"'==c){var v=t.concat(c);return i='"',v}return"<"==c?(r.setName(t),e.push(r),c):"TAG"!=r.type||r.name||" "!=c?"TEXT"==r.type&&(n=t.match(a))?(new f(e,n[0],t),c):t.concat(c):(r.setName(t),"")}),e}(t).filter(function(t){return""!=t.name.trim()}).map(function(t){return t.react()}).join().trim(),n=function(t){return new Function("React","return ".concat(t,";"))(m)}(e).replace(s,".when").trim();return console.info(e),n}function y(t,n,r){return new Proxy(t,function t(n,r,i){var a=new Map,c=new Map;return{get:function(o,s,u){if("$target"==s)return o;var h=a.get(s);if(void 0!=h)return h;var f=i?"".concat(i,".").concat(s):s;return"object"==e(h=Reflect.get(o,s))&&(h=new Proxy(h,t(n,r,f))),a.set(s,h),c.set(s,new Map),n.get(f),h},set:function(t,e,i,o){a.get(e);var s=c.get(e);return a.delete(e),c.delete(e),Reflect.set(t,e,i.$target||i),n.set(s,r),!0}}}(n,r))}function w(t,e,n){this.addEventListener?this.addEventListener(t,function(t){var r=this;e.forEach(function(e,i){e.forEach(function(e){var a=e?code("[".concat(e,"]"),n):[];a.push(t),i.apply(r,a)})})},!1):this.attachEvent?this.attachEvent("on".concat(t),function(t){e.forEach(function(e,r){e.forEach(function(e){var i=e?code("[".concat(e,"]"),n):[];i.push(t);var a=Reflect.getPrototypeOf(r),c=Object.assign({},a);Reflect.setPrototypeOf(c,n||r.$model),r.apply(c,i)})})}):element["on".concat(t)]=function(t){e.forEach(function(e,r){e.forEach(function(e){var i=e?code("[".concat(e,"]"),n):[];i.push(t);var a=Reflect.getPrototypeOf(r),c=Object.assign({},a);Reflect.setPrototypeOf(c,n||r.$model),r.apply(c,i)})})}}Object.assign(Node.prototype,{on:function(t,e,n,r){if(this._manager)if(this._manager.get(t)){var i=this._manager.get(t);i.get(e)?i.get(e).ones(r):i.set(e,[r])}else{var a=new Map;a.set(e,[r]),this._manager.set(t,a),w.call(this,t,a,n)}else{var c=new Map;c.set(e,[r]),this._manager=new Map,this._manager.set(t,c),w.call(this,t,c,n)}return this},off:function(t,e){if(this._manager){var n=this._manager.get(t);if(void 0==n)return;if(n.delete(e),n.size)return;this._manager.delete(t),function(t,e){this.addEventListener?this.removeEventListener(t,e,!1):this.detachEvent?this.detachEvent("on".concat(t),e):element["on".concat(t)]=null}.call(this,t,e)}return this},reappend:function(t){return u(slice(this.childNodes),function(t){t.parentNode.removeChild(t)}),this.appendChild(t),this},before:function(t){this.parentNode.insertBefore(t,this)},after:function(t){this.nextSibling?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.appendChild(t)}}),Object.assign(NodeList.prototype,{on:function(t,e){return u(this,function(n){n.on(t,e)}),this},off:function(t,e){return u(this,function(n){n.off(t,e)}),this}});var g=function(){function t(e){n(this,t),this.view=e.view,this.model=y(e.model,E,this),this.action=e.action,this.watch=e.watch,this.filter=e.filter,this.creater(e)}return i(t,[{key:"creater",value:function(t){this.view=d(this.view),this.node=p(this.view,this.model)}}]),t}(),E={set:function(t,e){var n=p(e.view,e.model);document.querySelector("app").innerHTML=n},get:function(t){}};return window.View=g,t.React=m,t.Render=v,t.View=g,t.query=function(t){try{return document.querySelectorAll(t)}catch(n){var e=document.createElement("div");return e.innerHTML=t.trim(),e.childNodes}},t}({});
