var view=function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}function c(e,n,t){for(;e.length;){var o=e[0];if(n.call(t,o,e))break}}function a(e,n,t){if(e)return t=t||e,Object.keys(e).every(function(o){var r=e[o];return!n.call(r,r,o,t)}),t}function i(e,n,t){if(e)if(e.hasOwnProperty("$index"))for(var o=e.$index;o<e.length;o++)n.call(t,e[o],o);else Object.keys(e).forEach(function(o){n.call(t,e[o],o)})}function s(e){return[].slice.call(e)}function l(e){return null==e||void 0==e||""==e}Object.assign(Array.prototype,{remove:function(e){var n=this.indexOf(e);return n>-1&&this.splice(n,1),this},replace:function(e,n){var t=this.indexOf(e);t>-1&&this.splice(t,1,n)},splices:function(e){this.splice.apply(this,e)},has:function(e){return this.indexOf(e)>-1},ones:function(e){this.has(e)||this.push(e)}});var d=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{|\{([^\{\}]*)\}|\}/g,u=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{/,h=/(@each)\s*\((.*)\)\s*\{/g,f=/(@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{/g,p=/\.when\s*\((.*)\)\s*\{|\.when\s*\{/g,v=/@when/g,m=/\{\s*@?([^\{\}]*)\}/,w=/\{([^\{\}]*)\}/g,y=/\{\s*@([^\{\}]*)\}/,g=/^\}$/,N=/(["'][^"']*["'])|(([_\$a-zA-Z]+\w?)((\.\w+)|(\[(.+)\]))*)/g,E=/^@(.*)/,b=new Map;function $(e,n){try{return F.$path=void 0,function(e,n){var t=b.get(e);void 0==t&&b.set(e,t=e.replace(N,function(e){return"scope.".concat(e)}));return new Function("scope","return ".concat(t,";"))(n)}(e=e.replace(m,"$1"),n)}catch(e){return void console.warn(e)}}function x(e,n){try{return F.$path=void 0,function(e,n){var t=b.get(e);void 0==t&&b.set(e,t=e.replace(N,function(e){return e.match(/["']/)?e:"scope.".concat(e)}));return new Function("scope","return ".concat(t,";"))(n)}(e="'".concat(e.replace(w,"'+($1)+'"),"'"),n)}catch(e){return void console.warn(e)}}function V(e,n,t,o){return{get:function(r,c){return n==c?Reflect.get(t,o):"".concat(n,"$")==c?Reflect.get(t,"".concat(o,"$")):"$target"==c?r:r.hasOwnProperty(c)?Reflect.get(r,c):Reflect.get(e,c)},set:function(r,c,a){return n==c?Reflect.set(t,o,a):r.hasOwnProperty(c)?Reflect.set(r,c,a):Reflect.set(e,c,a)}}}function R(e,n,t,o,r){function a(e,n){i(e.attributes,function(e){if(e){var t=function(e,n,t){return{node:e,clas:t,scope:n,children:[],childNodes:[]}}(e,n,e.cloneNode());":model"==t.clas.name?b(e,n):new RegExp(w).test(e.nodeValue)&&("value"==t.clas.name&&b(e,n),N.attrExpress(e,n,t,e.nodeValue),e.nodeValue=x(e.nodeValue,n)),function(e,n){e.name.replace(E,function(t){t=t.replace(E,"$1");var o=e.ownerElement,c=e.nodeValue.toString().match(/\(([^)]*)\)/);if(c){var a=e.nodeValue.toString().replace(c[0],""),i=$(a,r.action);o.on(t,i,n,c[1])}else{var s=$(e.nodeValue,r.action);o.on(t,s,n)}})}(e,n)}})}function d(e,n,t,o){var c;a(e,n),new RegExp(y).test(e.nodeValue)?(!function(e,n,t,o){var r=document.createComment("component");e.parentNode.replaceChild(r,e),t.scope=n,t.resolver="component",t.content=o,t.childNodes.push({node:r,content:t,children:[],childNodes:[]})}(e,n,t,o),O.component(t,r)):(c=new RegExp(w).exec(e.nodeValue))&&(N.express(e,n,t,c[1]),e.nodeValue=$(c[1],n))}function g(e){if(e)return new RegExp(p).test(e.clas.nodeValue)}var N={attrEach:function(e,n,t,o,c){t.resolver="each",t.content=o,t.scope=n,t.node=e,A(t,r,c)},each:function(e,n,t,o,c){t.resolver="each",t.content=o,t.scope=n,t.node=e,A(t,r,c)},when:function(e,n,t){var o=t.clas.nodeValue;new RegExp(f).exec(o)&&(t.resolver="when",t.scope=n,t.node=e,A(t,r,o))},express:function(e,n,t,o){t.resolver="express",t.scope=n,t.node=e,A(t,r,o)},attrExpress:function(e,n,t,o){t.resolver="express",t.scope=n,t.node=e,A(t,r,o)}};function b(e,n){var t=e.ownerElement;t._express=e.nodeValue.replace(m,"$1");var o="scope".concat(function(e){try{return e.replace(/(\w+)\.?/g,"['$1']")}catch(e){return void console.warn(e)}}(t._express));(R[t.type]||R[t.localName]||R.other)(e,n,o)}var R={checkbox:function(e,n,t){try{var o=e.ownerElement;o.on("change",function(){var e=o.value.replace(/(\'|\")/g,"\\$1"),r="".concat(t,".").concat(o.checked?"ones":"remove","('").concat(e,"');");new Function("scope",r)(n)},n);var r=$(o._express,n);Array.isArray(r)&&r.has(o.value)&&(o.checked=!0)}catch(e){console.error(e)}},radio:function(e,n,t){try{var o=e.ownerElement;o.on("change",function(){var e=o.value.replace(/(\'|\")/g,"\\$1"),r="".concat(t,"='").concat(e,"';");new Function("scope",r)(n)},n),$(o._express,n)==o.value&&(o.checked=!0),o.name=F.$path}catch(e){console.error(e)}},select:function(e,n,t){try{var o,r=e.ownerElement;r.on("change",o=function(){var e=r.value.replace(/(\'|\")/g,"\\$1"),o="".concat(t,"='").concat(e,"';");new Function("scope",o)(n)},n);var c=$(r._express,n);l(c)?o():r.value=c}catch(e){console.error(e)}},other:function(e,n,t){try{var o=e.ownerElement;o.on("change",function(){var e=o.value.replace(/(\'|\")/g,"\\$1"),r="".concat(t,"='").concat(e,"';");new Function("scope",r)(n)},n)}catch(e){console.error(e)}}};function C(e,n){return{node:e,clas:n.clas,children:n.children,scope:n.scope,childNodes:[]}}function P(e,n,t){var o=document.createComment("each:"+F.$path);return n.appendChild(o),{node:e,clas:t.clas,children:t.children,scope:t.scope,childNodes:[{node:o,clas:t.clas,scope:t.scope,children:[],childNodes:[]}]}}!function e(n,t,o,r){c(o,function(o,a){if(1==o.clas.nodeType)if(o.clas.hasAttribute("@each")){var l=(x=o.clas.getAttribute("@each").split(":")).shift().trim(),p=x.pop().trim(),m=x.shift(),w=$(p,t),y=P(null,n,o);r.childNodes.push(y),N.attrEach(null,t,y,r,p),i(w,function(c,a){var i=Object.create(t.$target);m&&(i[m.trim()]=a),i=new Proxy(i,V(t,l,w,a));var u=o.clas.cloneNode();u.removeAttribute("@each"),n.appendChild(u);var h=C(u,o);y.childNodes.push(h),e(u,i,s(o.children),h),d(u,i,h,r)})}else if(/(CODE|SCRIPT)/.test(o.clas.nodeName)){var E=o.clas.cloneNode(!0);n.appendChild(E);var b=C(E,o);r.childNodes.push(b)}else E=o.clas.cloneNode(),n.appendChild(E),b=C(E,o),r.childNodes.push(b),e(E,t,s(o.children),b),d(E,t,b,r);else if(h.test(o.clas.nodeValue)){var x;l=(x=o.clas.nodeValue.replace(h,"$2").split(":")).shift().trim(),p=x.pop().trim(),m=x.shift(),w=$(p,t),y=P(null,n,o),r.childNodes.push(y),N.each(null,t,y,r,p);var R=s(o.children);i(w,function(r,c){var a=Object.create(t.$target);m&&(a[m.trim()]=c),a=new Proxy(a,V(t,l,w,c));var i=C(null,o);y.childNodes.push(i),e(n,a,s(R),i)})}else{if(f.test(o.clas.nodeValue)){var O=$(o.clas.nodeValue.replace(f,"$2"),t);return(y=function(e,n,t,o,r){if(new RegExp(v).test(t.clas.nodeValue)){var c=document.createComment("when:"+F.$path);n.appendChild(c),o.childNodes.push(o={node:e,clas:t.clas,children:[],scope:t.scope,content:o,childNodes:[{node:c,clas:t.clas,scope:t.scope,children:[],childNodes:[]}]}),N.when(null,r,o)}return o}(null,n,o,r,t)).children.push(a.shift()),O?(N.when(null,t,y),c(a,function(e,n){if(!g(e))return!0;y.children.push(n.shift())}),c(s(o.children),function(o,r){if(1==o.clas.nodeType||u.test(o.clas.nodeValue))e(n,t,r,y);else{var c=o.clas.cloneNode();n.appendChild(c);var a=C(c,o);y.childNodes.push(a),d(c,t,a,y)}r.shift()})):void 0==O?(N.when(null,t,y),c(s(o.children),function(o,r){if(1==o.clas.nodeType||u.test(o.clas.nodeValue))e(n,t,r,y);else{var c=o.clas.cloneNode();n.appendChild(c);var a=C(c,o);y.childNodes.push(a),d(c,t,a,y)}r.shift()})):g(a[0])&&e(n,t,a,y),g(o)}E=o.clas.cloneNode(),n.appendChild(E),b=C(E,o),r.childNodes.push(b),d(E,t,b,r)}a.shift()})}(e,n,t,o)}var O={view:function(e,n,t,o,r){try{var c=document.createDocumentFragment();new R(c,t,s(n.children),o,r),o.children=n.children,o.clas=n.clas,e.reappend(c)}catch(e){console.error(e)}},component:function(e,n){try{var t=$(e.clas.nodeValue,e.scope);if(t.model=t.model.$target||t.model,e.path=F.$path,l(t))return;Reflect.setPrototypeOf(t.model,e.scope);var o=j(e.childNodes),r=e.content.childNodes;k(e.childNodes);var c=new q({view:t.component,model:t.model,action:t.action});t.model=c.model;var a=function(e,n,t){var o=document.createComment("component:"+n.path);return Reflect.deleteProperty(n,"path"),e.before(o),t.content.node=t.view,{clas:n.clas,children:[t.node],scope:n.scope,resolver:n.resolver,content:n.content,childNodes:[{node:o,scope:n.scope,children:[],childNodes:[]},t.content]}}(o,e,c);A(a,n,e.clas.nodeValue),r.replace(e,a),o.parentNode&&o.parentNode.replaceChild(c.view,o)}catch(e){console.error(e)}},when:function(e,n){try{var t=j(e.childNodes),o=document.createDocumentFragment(),r=e.content.childNodes;k(e.childNodes),new R(o,e.scope,s(e.children),e.content,n),r.replace(e,r.pop()),t.parentNode&&t.parentNode.replaceChild(o,t)}catch(e){console.error(e)}},each:function(e,n){try{var t=j(e.childNodes),o=document.createDocumentFragment(),r=e.content.childNodes;k(e.childNodes),new R(o,e.scope,[e],e.content,n),r.replace(e,r.pop()),t.parentNode&&t.parentNode.replaceChild(o,t)}catch(e){console.error(e)}},arrayEach:function(e,n,t,o){try{var r=function e(n,t){try{return a(n,function(n){if(n.node&&n.node.parentNode)return t=n.node;if(n.childNodes.length){var o=n.childNodes[n.childNodes.length-1];if(o.node&&o.node.parentNode)return t=o.node;t=e([o])}}),t}catch(e){console.error(e)}}([e.childNodes[t]]),c=document.createDocumentFragment(),i={clas:e.clas,children:e.children,scope:e.scope},l={childNodes:[],children:[]};new R(c,e.scope,[i],l,n),c.removeChild(c.childNodes[0]);var d=s(l.childNodes[0].childNodes);d.splice(0,1,t+1,0),e.childNodes.splices(d),o.remove(l.childNodes[0]),r.parentNode&&r.after(c)}catch(e){console.error(e)}},express:function(e,n){try{e.node.nodeValue=x(e.clas.nodeValue,e.scope),A(e,n,e.clas.nodeValue),"value"==e.node.name&&(e.node.ownerElement.value=e.node.nodeValue)}catch(e){console.error(e)}},attribute:function(e,n){try{var t=document.createAttribute(x(e.clas.name,scope));A(e,n,e.clas.name),t.nodeValue=e.clas.nodeValue,e.node.ownerElement.setAttributeNode(t),e.node.ownerElement.removeAttributeNode(e.node)}catch(e){console.error(e)}}},C=function(e,n,t){e.forEach(function(o,r){o.forEach(function(c){try{P[c.resolver]?P[c.resolver](c,r,o,n,t):O[c.resolver](c,r,e)}catch(e){console.error(e)}})})},P={each:function(e,n,t,o,r){try{if(r>0)O.arrayEach(e,n,o,t);else k(e.childNodes.splice(o+1))}catch(e){console.error(e)}}};function A(e,n,t){t.replace(N,function(t){if(!t.match(/["']/)){var o=new Function("scope","return scope.".concat(t,"$;"))(e.scope);if(void 0!=o){var r=o.get(n);r?r.ones(e):o.set(n,[e])}}})}function j(e,n){try{return a(e,function(e){if(e.node&&e.node.parentNode)return n=e.node,e.node=null,n;n=j(e.childNodes)}),n}catch(e){console.error(e)}}function k(e){e.forEach(function(e){if(e.node&&e.node.parentNode)return e.node.parentNode.removeChild(e.node);e.childNodes&&k(e.childNodes)})}function S(e,t){if("object"!=n(e))return e;return e=new Proxy(e,function t(o){var r=new Map,c=new Map;return{get:function(a,i,s){if("$target"==i)return a;if(new String(i).endsWith("$")){var l=c.get(i);return void 0!=l?l:Reflect.get(a,i)}if(!a.hasOwnProperty(i)&&Reflect.has(a,i))return Reflect.get(a,i);var d=o?"".concat(o,".").concat(i):i;_.publish(e,"get",[d]);var u=r.get(i);return void 0!=u?u:(c.set("".concat(i,"$"),new Map),(u=Reflect.get(a,i))instanceof View?u:("object"==n(u)&&(u=new Proxy(u,t(d))),function(e,n){if(!Array.isArray(e))return;Reflect.setPrototypeOf(e,{shift:function(){var e=Array.prototype.shift,t=e.apply(this,arguments),o=this.length;return C(n,o),t},pop:function(){var e=Array.prototype.pop,t=e.apply(this,arguments),o=this.length;return C(n,o),t},splice:function(){var e=Array.prototype.splice;if(this.length){var t=this.length,o=e.apply(this,arguments);return arguments.length>2?this.$index=t:t=this.length,C(n,t,arguments.length-2),Reflect.deleteProperty(this,"$index"),o}},unshift:function(){var e=Array.prototype.unshift;if(arguments.length){var t=this.$index=this.length,o=e.apply(this,arguments);return C(n,t,arguments.length),Reflect.deleteProperty(this,"$index"),o}},push:function(){var e=Array.prototype.push;if(arguments.length){var t=this.$index=this.length,o=e.apply(this,arguments);return C(n,t,arguments.length),Reflect.deleteProperty(this,"$index"),o}},reverse:function(){var e=Array.prototype.reverse,n=e.apply(this,arguments);return n},sort:function(){var e=Array.prototype.sort,n=e.apply(this,arguments);return n}})}(u,c.get("".concat(i,"$"))),r.set(i,u),u))},set:function(t,o,a,i){if(!t.hasOwnProperty(o)&&Reflect.has(t,o))return Reflect.set(t,o,a);var s=r.get(o),l=c.get("".concat(o,"$"));r.delete(o),c.delete("".concat(o,"$")),Reflect.set(t,o,a.$target||a);var d=i[o];return function t(o,r){if(o instanceof View)return;"object"==n(o)&&"object"==n(r)&&Object.keys(r).forEach(function(c){var a=o[c],i=o["".concat(c,"$")],s=r[c],l=r["".concat(c,"$")];"object"!=n(a)&&"object"!=n(s)&&_.publish(e,"set",[l,i]),t(a,s)})}(d,s),_.publish(e,"set",[l,c.get("".concat(o,"$"))]),!0}}}()),Object.keys(t).forEach(function(n){return _.subscribe(e,n,t[n])}),e}var _=new(function(){function e(){t(this,e),this.map=new Map}return r(e,[{key:"publish",value:function(e,n,t){var o=this.map.get(e);if(o){var r=o.get(n);r?r.data.push(t):o.set(n,{data:[t],queue:[]})}else{var c=new Map;c.set(n,{data:[c],queue:[]}),this.map.set(e,c)}this.notify(o.get(n),e)}},{key:"notify",value:function(e,n){if(e)for(var t=function(){var t=e.data.shift();e.queue.forEach(function(e){e.apply(n,t)})};e.data.length;)t();else this.map.forEach(function(e){e.forEach(function(e){for(var t=function(){var t=e.data.shift();e.queue.forEach(function(e){e.apply(n,t)})};e.data.length;)t()})})}},{key:"subscribe",value:function(e,n,t){var o=this.map.get(e);if(o){var r=o.get(n);r?r.queue.push(t):o.set(n,{data:[],queue:[t]})}else{var c=new Map;c.set(n,{data:[],queue:[t]}),this.map.set(e,c)}}}]),e}());function T(e){try{return document.querySelectorAll(e)}catch(t){var n=document.createElement("div");return n.innerHTML=e.trim(),n.childNodes}}function M(e,n,t){this.addEventListener?this.addEventListener(e,function(e){n.forEach(function(n,o){n.forEach(function(n){var r=n?$("[".concat(n,"]"),t):[];r.push(e);var c=Reflect.getPrototypeOf(o),a=Object.assign({},c);Reflect.setPrototypeOf(a,t||o.$model),o.apply(a,r)})})},!1):this.attachEvent?this.attachEvent("on"+e,function(e){n.forEach(function(n,o){n.forEach(function(n){var r=n?$("[".concat(n,"]"),t):[];r.push(e);var c=Reflect.getPrototypeOf(o),a=Object.assign({},c);Reflect.setPrototypeOf(a,t||o.$model),o.apply(a,r)})})}):element["on"+e]=function(e){n.forEach(function(n,o){n.forEach(function(n){var r=n?$("[".concat(n,"]"),t):[];r.push(e);var c=Reflect.getPrototypeOf(o),a=Object.assign({},c);Reflect.setPrototypeOf(a,t||o.$model),o.apply(a,r)})})}}Object.assign(Node.prototype,{on:function(e,n,t,o){if(this._manager)if(this._manager.get(e)){var r=this._manager.get(e);r.get(n)?r.get(n).ones(o):r.set(n,[o])}else{var c=new Map;c.set(n,[o]),this._manager.set(e,c),M.call(this,e,c,t)}else{var a=new Map;a.set(n,[o]),this._manager=new Map,this._manager.set(e,a),M.call(this,e,a,t)}return this},off:function(e,n){if(this._manager){var t=this._manager.get(e);if(void 0==t)return;if(t.delete(n),t.size)return;this._manager.delete(e),function(e,n){this.addEventListener?this.removeEventListener(e,n,!1):this.detachEvent?this.detachEvent("on"+e,n):element["on"+e]=null}.call(this,e,n)}return this},reappend:function(e){return a(s(this.childNodes),function(e){e.parentNode.removeChild(e)}),this.appendChild(e),this},before:function(e){this.parentNode.insertBefore(e,this)},after:function(e){this.nextSibling?this.parentNode.insertBefore(e,this.nextSibling):this.parentNode.appendChild(e)}}),Object.assign(NodeList.prototype,{on:function(e,n){return a(this,function(t){t.on(e,n)}),this},off:function(e,n){return a(this,function(t){t.off(e,n)}),this}});var F={$path:void 0},q=function(){function e(n){t(this,e),this.content={childNodes:[],children:[]},this.model=n.model,this.action=n.action,this.watch=n.watch,this.filter=n.filter,n.view?this.view(n):this.component(n)}return r(e,[{key:"view",value:function(e){e.model=S(e.model,{set:function(e,n){!function(e,n){e&&n?e.forEach(function(e,t){s(e).forEach(function(o){!function e(n,t){try{return n.every(function(n){if(n.node){var o=n.node.ownerElement||n.node;return t=document.body.contains(o),!1}t=e(n.childNodes)}),t}catch(e){console.error(e)}}([o])?e.remove(o):O[o.resolver](o,t,n)})}):e&&!n&&e.forEach(function(e,n){k(e)})}(e,n)},get:function(e){F.$path=e}}),this.model=e.model;var n=T(e.view),t=function e(n,t){var o=t||[];return c(n,function(t){if(n.shift(),new RegExp(g).test(t.nodeValue))return!0;var r={clas:t.cloneNode(!0),children:[]};3==t.nodeType&&""==t.nodeValue.trim()||o.push(r),1==t.nodeType?e(s(t.childNodes),r.children):new RegExp(u).test(t.nodeValue)&&e(n,r.children)}),o}(function e(n){return a(n,function(n){n.childNodes[0]&&!/(CODE|SCRIPT)/.test(n.nodeName)&&e(s(n.childNodes)),3==n.nodeType&&n.nodeValue.replace(d,function(e){var t=n.nodeValue.split(e);n.parentNode.insertBefore(document.createTextNode(t[0]),n),n.parentNode.insertBefore(document.createTextNode(e.trim()),n),n.nodeValue=n.nodeValue.replace(t[0],"").replace(e,"")})}),n}(s(n)))[0];this.node=t,this.view=n[0],O.view(this.view,t,e.model,this.content,this)}},{key:"component",value:function(e){var n=T(e.component);this.view=n[0],this.view.parentNode.removeChild(this.view),this.component=this.view.outerHTML}}]),e}();return window.View=q,window.Router=function(e,n){var t,o,r,c=/^:/,a=/^\/(.+)/;this.redreact=u;var i,s=!((i=window.navigator.userAgent).indexOf("compatible")>-1&&i.indexOf("MSIE")>-1||i.indexOf("Trident")>-1||i.indexOf("Edge")>-1)&&window.history&&"pushState"in window.history;function l(e){for(r=Object.keys(n);r.length;){t=r.shift(),o={};var c=t.replace(a,"$1");if(d(c=c.split("/"),e.split("/")))return{component:n[t].component,router:n[t].router,action:n[t].action,after:n[t].after,params:o,path:e}}}function d(e,n){for(;n.length;){var t=e.shift(),r=n.shift();if(r!=t){if(!c.test(t))return!1;t=t.replace(c,""),o[t]=r}}return!0}function u(e){var n=window.location.pathname;window.location.href=n+"#"+e}function h(n){var t=l(window.location.hash.replace(/^#\/?/,""));t?(t.action(t.params),e.model[t.router]=t.component,t.after&&t.after()):void 0!=n&&"load"!=n.type||u("")}window.addEventListener("load",h,h()),window.addEventListener(s?"popstate":"hashchange",h,!1)},window.query=T,e.View=q,e.global=F,e}({});
