var view=function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function a(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}var r=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{|\{([^\{\}]*)\}|\}/g,i=/(@each|@when|\.when)\s*(\((.*)\))?\s*\{/,s=/\{([^\{\}]*)\}/,o=/,\s*\.when/g;function u(t,e){Object.keys(t).forEach(function(n){var c=Reflect.get(t,n);e(c,n)})}var h=function(){function t(e){n(this,t),this.type="TAG",this.name=e,this.attrs={}}return a(t,[{key:"setName",value:function(t){if(""!=t)if(this.name){var e=t.indexOf("="),n=t.slice(0,e),c=t.slice(e+2,t.length-1);Reflect.set(this.attrs,n,c)}else this.name=t}},{key:"react",value:function(){if(this.name.startsWith("/"))return")";if(e=this.name,n=document.createElement(e),new RegExp(/<\/\w+>/).test(n.outerHTML)){var t=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(t)}var e,n,c=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(c,")")}}]),t}(),f=function(){function t(e,c,a){n(this,t),this.type="FUNC",this.name=c,this.attrs={},this.setName(e,a)}return a(t,[{key:"setName",value:function(t,e){if(this.name.startsWith(".when")){t.push(this);var n=this.name.match(i);this.attrs=n[3],this.name=n[1]}else if(this.name.startsWith("}")){var c=e.slice(0,e.indexOf(this.name));t.push(new l(c)),t.push(this)}else if(this.name.startsWith("{")){var a=e.slice(0,e.indexOf(this.name));t.push(new l(a)),t.push(new l(this.name))}else{var r=e.slice(0,e.indexOf(this.name));t.push(new l(r)),t.push(this);var s=this.name.match(i);this.attrs=s[3],this.name=s[1]}}},{key:"react",value:function(){if(this.name.startsWith("}"))return")";var t=JSON.stringify(this.attrs);return'React.createFunction("'.concat(this.name,'",').concat(t)}}]),t}(),l=function(){function t(e){n(this,t),this.type="TEXT",this.name=e}return a(t,[{key:"setName",value:function(t){this.name=t}},{key:"react",value:function(){var t=this.name.replace(/\n/g,"");return'React.createRender("'.concat(t,'",null)')}}]),t}(),p=function(){function t(e,c,a){n(this,t),this.func=a,this.scope=e,this.params=c,this.status=null,this.value=new Map}return a(t,[{key:"when",value:function(t,e){var n=this.value;if(null==this.status&&t){this.status=t;var c=e(this.scope);n.set(this.scope,c)}else if(null==this.status&&void 0==t){this.status=t;var a=e(this.scope);n.set(this.scope,a)}return this}},{key:"forEach",value:function(t,e){var n=this,c=this.value,a=this.params.split(","),r=a[0],i=a[1];return u(t,function(a,s){var o=Object.create(n.scope.$target);o[i]=s,o=new Proxy(o,function(t,e,n,c){return{get:function(a,r){return n==r?Reflect.get(e,c):"".concat(n,"$")==r?Reflect.get(e,"".concat(c,"$")):"$target"==r?a:a.hasOwnProperty(r)?Reflect.get(a,r):Reflect.get(t,r)},set:function(a,r,i){return n==r?Reflect.set(e,c,i):a.hasOwnProperty(r)?Reflect.set(a,r,i):Reflect.set(t,r,i)}}}(n.scope,t,r,s)),v(R.cache,e,o),R.cache=new Map;var u=e(o);c.set(o,u)}),this}},{key:"toString",value:function(){return this.value.join("")}}]),t}(),m={createFunction:function(t,e){for(var n=arguments.length,c=new Array(n>2?n-2:0),a=2;a<n;a++)c[a-2]=arguments[a];if("@when"==t)return"\n _scope=>new Render(_scope,null,arguments.callee).when(".concat(w(e),", () => [").concat(c,"])");if(".when"==t)return"\n .when(".concat(w(e),", () => [").concat(c,"])");if("@each"==t){var r=e.split(":"),i=r.pop();return"\n _scope=>new Render(_scope,'".concat(r,"',arguments.callee).forEach(").concat(w(i),", (_scope) => [").concat(c,"])")}},createRender:function(t,e){var n;if(e){for(var c=arguments.length,a=new Array(c>2?c-2:0),r=2;r<c;r++)a[r-2]=arguments[r];return'\n _scope=>React.createElement("'.concat(t,'",_scope,arguments.callee,').concat(JSON.stringify(e),",").concat(a,")")}return(n=t.match(s))?"\n _scope=>React.createElement(".concat(w(n[1]),",_scope,arguments.callee,null)"):'\n _scope=>React.createElement("'.concat(t,'",_scope,arguments.callee,null)')},createElement:function(t,e,n,c){if(c){for(var a=document.createElement(t),r=arguments.length,i=new Array(r>4?r-4:0),s=4;s<r;s++)i[s-4]=arguments[s];return i.forEach(function(t){return function t(e,n,c){var a=c(n);a instanceof p?a.value.forEach(function(n,c){return n.forEach(function(n){return t(e,c,n)})}):e.appendChild(a)}(a,e,t)}),v(R.cache,n,e,a),R.cache=new Map,function(t,e){u(e,function(e,n){if(n.startsWith("@"))!function(t,e,n,c){var a=n.match(/(.*)\((.*)\)/);if(a){var r=a[1],i=Reflect.get(c,r);t.on(e,i,we.model,a[2])}else{var s=Reflect.get(c,n);t.on(e,s,we.model)}}(t,n.slice(1),e,we.action);else{var c=document.createAttribute(n);c.value=e,t.setAttributeNode(c)}})}(a,c),a}var o=document.createTextNode(t);return v(R.cache,n,e,o),R.cache=new Map,o}};function v(t,e,n,c){t.forEach(function(t){t&&t.set(e,{scopes:n,element:c})})}function w(t){var e,n;if(t)return t.split("").reduce(function(t,c){return!e&&t.match(/\w/)&&(e="_scope.".concat(t)),"'"==n&&"'"==t?(n=null,e=e.concat(c),c):"'"==n?(e=e.concat(c),c):"'"==t?(n=t,e=e.concat(c),c):t.match(/\W/)&&!t.match(/\.|\$|_/)&&c.match(/\w/)&&!c.match(/\d/)?(e=e.concat("_scope.").concat(c),c):(e=e.concat(c),c)}),e}function d(t){return function(t){return new Function("React","return ".concat(t,";"))(m)}(function(t){var e=[],n=null,c=null,a=null;return function(t){return t.split("")}(t).reduce(function(t,i){if("<"==t){var s=i;return a=">",c=new h,s}if('"'==a&&'"'==i){var o=t.concat(i);return c.setName(o.trim()),a=">",""}if(">"==a&&">"==i){var u=t;return a=null,c.setName(u),e.push(c),c=new l,""}if('"'==i){var p=t.concat(i);return a='"',p}return"<"==i?(c.setName(t),e.push(c),i):"TAG"!=c.type||c.name||" "!=i?"TEXT"==c.type&&(n=t.match(r))?(new f(e,n[0],t),i):t.concat(i):(c.setName(t),"")}),e}(t).filter(function(t){return""!=t.name.trim()}).map(function(t){return t.react()}).join().trim()).replace(o,".when").trim()}function g(t,n,c){return new Proxy(t,function t(n,c,a){var r=new Map,i=new Map;return{get:function(s,o,u){if("$target"==o)return s;var h=r.get(o),f=a?"".concat(a,".").concat(o):o;return R.cache.delete(a),R.cache.set(f,i.get(o)),void 0!=h?h:("object"==e(h=Reflect.get(s,o))&&(h=new Proxy(h,t(n,c,f))),r.set(o,h),i.set(o,new Map),R.cache.delete(a),R.cache.set(f,i.get(o)),n.get(f),h)},set:function(t,e,a,s){r.get(e);var o=i.get(e);return r.delete(e),i.delete(e),Reflect.set(t,e,a.$target||a),n.set(o,c),!0}}}(n,c))}function y(t,e,n){this.addEventListener?this.addEventListener(t,function(t){e.forEach(function(e,c){e.forEach(function(e){var a=e?[e]:[];a.push(t),c.apply(n,a)})})},!1):this.attachEvent?this.attachEvent("on".concat(t),function(t){e.forEach(function(e,c){e.forEach(function(e){var a=e?code("[".concat(e,"]"),n):[];a.push(t);var r=Reflect.getPrototypeOf(c),i=Object.assign({},r);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,a)})})}):element["on".concat(t)]=function(t){e.forEach(function(e,c){e.forEach(function(e){var a=e?code("[".concat(e,"]"),n):[];a.push(t);var r=Reflect.getPrototypeOf(c),i=Object.assign({},r);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,a)})})}}Object.assign(Node.prototype,{on:function(t,e,n,c){if(this._manager)if(this._manager.get(t)){var a=this._manager.get(t);a.get(e)?a.get(e).ones(c):a.set(e,[c])}else{var r=new Map;r.set(e,[c]),this._manager.set(t,r),y.call(this,t,r,n)}else{var i=new Map;i.set(e,[c]),this._manager=new Map,this._manager.set(t,i),y.call(this,t,i,n)}return this},off:function(t,e){if(this._manager){var n=this._manager.get(t);if(void 0==n)return;if(n.delete(e),n.size)return;this._manager.delete(t),function(t,e){this.addEventListener?this.removeEventListener(t,e,!1):this.detachEvent?this.detachEvent("on".concat(t),e):element["on".concat(t)]=null}.call(this,t,e)}return this},reappend:function(t){return this.innerHTML="",this.appendChild(t),this},before:function(t){this.parentNode.insertBefore(t,this)},after:function(t){this.nextSibling?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.appendChild(t)}}),Object.assign(NodeList.prototype,{on:function(t,e){return u(this,function(n){n.on(t,e)}),this},off:function(t,e){return u(this,function(n){n.off(t,e)}),this}});var R={$path:null,cache:new Map},E=function(){function t(e){n(this,t),this.view=e.view,this.model=g(e.model,b,this),this.action=e.action,this.watch=e.watch,this.filter=e.filter,this.creater(e)}return a(t,[{key:"creater",value:function(t){var e,n;this.view=d(this.view),console.warn(this.view),this.node=(e=this.view,n=this,window.we=n,new Function("we","React","Render","return ".concat(e,";\n    "))(n,m,p))(this.model)}}]),t}(),b={set:function(t,e){t.forEach(function(t,e){e(t);console.log(e.toString())})},get:function(t){}};return window.View=E,t.React=m,t.Render=p,t.View=E,t.global=R,t.query=function(t){try{return document.querySelectorAll(t)}catch(n){var e=document.createElement("div");return e.innerHTML=t.trim(),e.childNodes}},t}({});
