var view=function(e){"use strict";var n=/((@each|@when|\.when)\s*\((.*)\)\s*\{|\{\s*\{([^\{\}]*)\}\s*\}|\s*\}\s*|\.when\s*\{)/g,t=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{/,o=/(@each)\s*\((.*)\)\s*\{/g,r=/(@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{/g,c=/\.when\s*\((.*)\)\s*\{|\.when\s*\{/g,a=/@when/g,i=/\{\s*\{@?([^\{\}]*)\}\s*\}/,s=/\{\s*\{([^\{\}]*)\}\s*\}/g,l=/\{\s*\{\s*@([^\{\}]*)\}\s*\}/,d=/(^\s*\}\s*$)/,u=/(\w+)((\.\w+)|(\[(.+)\]))*/g,h=/^@(.*)/;function p(e,n){try{return D.$path=void 0,v(e=e.replace(i,"$1"))(n)}catch(e){return}}function f(e,n){try{return v(e="'"+e.replace(s,"'+($1)+'")+"'")(n)}catch(e){return}}function v(e){return new Function("_scope","with (_scope) {\n       return "+e+";\n    }")}function w(e){try{return e.replace(/(\w+)\.?/g,"['$1']")}catch(e){return}}function m(e,n,t){Object.defineProperty(e,n,{get:function(){return new Function("scope","\n        return scope"+w(t)+";\n        ")(e)},set:function(n){new Function("scope","val","\n        scope"+w(t)+"=val;\n        ")(e,n)}})}var N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},b=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function g(e,n,t){var o=!0;function r(n,t,r){if(Array.isArray(n)){!function(n,t){var r=Array.prototype;function c(o){new Function("scope","val","\n        scope"+w(t)+"=val;\n        ")(e,n)}["shift","push","pop","splice","unshift","reverse"].forEach(function(e){var t=r[e];switch(e){case"shift":a(n,e,function(){o=!1;var e=t.apply(this,arguments);return o=!0,c([0]),e});break;case"pop":a(n,e,function(){var e=t.apply(this,arguments);return c([this.length]),e});break;case"splice":a(n,e,function(e,n){o=!1;for(var r=t.apply(this,arguments),a=[],i=new Number(e)+new Number(n);e<i;)a.push(e++);return o=!0,c(a),r});break;case"push":a(n,e,function(e){var n=t.call(this,e);return c([]),n});break;default:a(n,e,function(){o=!1;var e=t.apply(this,arguments);return c([]),e})}})}(n,t);for(var i=0;i<n.length;i++)n.hasOwnProperty(i)&&c(n,i,t,r)}else if("object"==(void 0===n?"undefined":N(n)))for(var i in n)n.hasOwnProperty(i)&&c(n,i,t,r)}function c(n,t,c,a){var i=n[t],s=(a||{})[t],l=c?c+"."+t:t;i instanceof B||"object"!=(void 0===i?"undefined":N(i))||r(i,l,s),function(n,t,c,a){var i=n[t],s=new Map;Object.defineProperty(n,t,{get:function(){return $.publish(e,"get",[c]),D.$attres=s,i},set:function(n){var t=i;r(i=n,c,t),D.$attres=s,o&&$.publish(e,"set",[c])}})}(n,t,l)}function a(e,n,t){Object.defineProperty(e,n,{writable:!0,value:t})}$.subscribe(e,"set",n),$.subscribe(e,"get",t),r(e)}var $=new(function(){function e(){y(this,e),this.map=new Map}return b(e,[{key:"publish",value:function(e,n,t){var o=this.map.get(e);if(o){var r=o.get(n);r?r.data.push(t):o.set(n,{data:[t],queue:[]})}else{var c=new Map;c.set(n,{data:[c],queue:[]}),this.map.set(e,c)}this.notify(o.get(n))}},{key:"notify",value:function(e){if(e)for(var n=function(){var n=e.data.shift();e.queue.forEach(function(e){e(n[0],n[1],n[2])})};e.data.length;)n();else this.map.forEach(function(e){e.forEach(function(e){for(var n=function(){var n=e.data.shift();e.queue.forEach(function(e){e(n[0],n[1],n[2])})};e.data.length;)n()})})}},{key:"subscribe",value:function(e,n,t){var o=this.map.get(e);if(o){var r=o.get(n);r?r.queue.push(t):o.set(n,{data:[],queue:[t]})}else{var c=new Map;c.set(n,{data:[],queue:[t]}),this.map.set(e,c)}}}]),e}());function V(e,n){for(;e.length;){var t=e[0];if(n.call(t,t,e))break}}function E(e,n,t){if(e){if(t=t||e,Array.isArray(e)){for(var o=e.length,r=0;r<o;r++)if(e.hasOwnProperty(r)){var c=e[r];if(n.call(c,c,r,t))break}}else for(var r in e)if(e.hasOwnProperty(r)){c=e[r];if(n.call(c,c,r,t))break}return t}}function C(e,n){if(Array.isArray(e))for(var t=e.length,o=0;o<t;o++)e.hasOwnProperty(o)&&n(e[o],o);else for(var o in e)e.hasOwnProperty(o)&&n(e[o],o)}function O(e){var n=[];return C(e,function(e){n.push(e)}),n}function x(e,n){var t=e.prototype||e.__proto__;for(var o in n)t[o]=n[o];return e}function k(e){return null==e||void 0==e||""==e}function A(e){try{return document.querySelectorAll(e)}catch(t){var n=document.createElement("div");return n.innerHTML=e.trim(),n.childNodes}}function T(e,n,c,i,s){V(c,function(c,l){switch(c.clas.nodeType){case 1:if(c.clas.hasAttribute("each")){var d=(y=c.clas.getAttribute("each").split(":")).shift().trim(),u=y.pop().trim(),h=y.shift(),f=p(u,n),v=q(null,e,c);i.childNodes.push(v),P(null,n,v,i,s),C(f,function(t,o){var r=Object.create(n||{});m(r,d,D.$path),h&&(r[h.trim()]=o.toString());var a=c.clas.cloneNode();a.removeAttribute("each"),e.appendChild(a);var l=R(a,c);v.childNodes.push(l),T(a,r,O(c.children),l,s),S(a,r,l,i,s)})}else switch(/(CODE|SCRIPT)/.test(c.clas.nodeName)){case!0:var w=c.clas.cloneNode(!0);e.appendChild(w);var N=R(w,c);i.childNodes.push(N);break;default:w=c.clas.cloneNode();e.appendChild(w);N=R(w,c);i.childNodes.push(N),T(w,n,O(c.children),N,s),S(w,n,N,i,s)}break;default:if(o.test(c.clas.nodeValue)){var y;d=(y=c.clas.nodeValue.replace(o,"$2").split(":")).shift().trim(),u=y.pop().trim(),h=y.shift(),f=p(u,n),v=q(null,e,c);i.childNodes.push(v),P(null,n,v,i,s);var b=O(c.children);C(f,function(t,o){var r=Object.create(n||{});m(r,d,D.$path),h&&(r[h.trim()]=o.toString());var a=R(null,c);v.childNodes.push(a),T(e,r,O(b),a,s)})}else{if(r.test(c.clas.nodeValue)){var g=p(c.clas.nodeValue.replace(r,"$2"),n);return(v=function(e,n,t,o,r,c){if(new RegExp(a).test(t.clas.nodeValue)){var i=document.createComment("when:"+D.$path);n.appendChild(i),o.childNodes.push(o={node:e,clas:t.clas,children:[],scope:t.scope,content:o,childNodes:[{node:i,clas:t.clas,children:[],scope:t.scope,childNodes:[]}]}),P(null,r,o,c)}return o}(null,e,c,i,n,s)).children.push(l.shift()),g?(P(null,n,v,i,s),V(l,function(e,n){if(!_(e))return!0;v.children.push(n.shift())}),V(O(c.children),function(o,r){switch(1==o.clas.nodeType||t.test(o.clas.nodeValue)){case!0:T(e,n,r,v,s);break;default:var c=o.clas.cloneNode();e.appendChild(c);var a=R(c,o);v.childNodes.push(a),S(c,n,a,v,s)}r.shift()})):void 0==g?(P(null,n,v,i,s),V(O(c.children),function(o,r){switch(1==o.clas.nodeType||t.test(o.clas.nodeValue)){case!0:T(e,n,r,v,s);break;default:var c=o.clas.cloneNode();e.appendChild(c);var a=R(c,o);v.childNodes.push(a),S(c,n,a,v,s)}r.shift()})):_(l[0])&&T(e,n,l,v,s),_(c)}w=c.clas.cloneNode();e.appendChild(w);N=R(w,c);i.childNodes.push(N),S(w,n,N,i,s)}}l.shift()})}function S(e,n,t,o,r){C(e.attributes,function(e){var t=function(e,n,t){return{node:e,clas:t,children:[],scope:n,childNodes:[]}}(e,n,e.cloneNode());S(e,n,t,null,r)}),new RegExp(l).test(e.nodeValue)?(!function(e,n,t,o){var r=document.createComment("component");e.parentNode.replaceChild(r,e),t.scope=n,t.resolver="component",t.content=o,t.childNodes.push({node:r,children:[],content:t,childNodes:[]})}(e,n,t,o),F.component(t)):new RegExp(i).test(e.nodeValue)&&(P(e,n,t,o,r),e.nodeValue=f(e.nodeValue,n)),new RegExp(h).test(e.name)&&function(e,n){e.name.replace(h,function(t){t=t.replace(h,"$1");var o=e.ownerElement;o.on(t,function(t){var o,r,c,a,i,s;o=e.nodeValue,r=n,c=t,a=o.toString().match(/\(([^)]*)\)/),i=o.toString().replace(a[0],""),(s=p("["+a[1]+"]",r)).push(c),p(i,r.$action).apply(r,s)})})}(e,n)}function _(e){if(e)return new RegExp(c).test(e.clas.nodeValue)}function P(e,n,t,c,a){try{var l=t.clas.nodeValue;switch(t.clas.nodeType){case 1:if(void 0==p(t.clas.getAttribute("each").split(":").pop(),n)||void 0==D.$path)return;t.resolver="each",t.content=c,t.scope=n,t.path=[D.$path],t.node=e;break;case 2:l.replace(s,function(o){t.resolver="express",t.scope=n,t.path=[],t.node=e,j(o,n,t,a),"value"==t.clas.name&&function(e,n){var t,o=e.ownerElement;if(o._express=e.nodeValue.replace(i,"$1"),o.on("change",t=function(){new Function("scope","\n      scope"+w(o._express)+"='"+o.value.replace(/(\'|\")/g,"\\$1")+"';\n      ")(n)}),"SELECT"==o.nodeName){var r=p(o._express,n);k(r)?t():o.value=r}}(e,n)});break;default:l.replace(o,function(r){if(void 0!=p(r=r.replace(o,"$2").split(":").pop(),n)&&void 0!=D.$path)throw t.resolver="each",t.content=c,t.scope=n,t.path=[D.$path],t.node=e,null}),l.replace(r,function(o){throw o=o.replace(r,"$2"),t.resolver="when",t.scope=n,t.path=[],t.node=e,j(o,n,t),null}),l.replace(i,function(o){t.resolver="express",t.scope=n,t.path=[],t.node=e,j(o,n,t)})}}catch(e){}}function j(e,n,t,o){e.replace(u,function(e){if(void 0!=p(e,n)&&void 0!=D.$path){if(2==t.clas.nodeType){var r=D.$attres.get(o);r?r.push(t):D.$attres.set(o,[t])}t.path.push(D.$path)}})}function R(e,n){return{node:e,clas:n.clas,children:n.children,scope:n.scope,childNodes:[]}}function q(e,n,t){var o=document.createComment("each:"+D.$path);return n.appendChild(o),{node:e,clas:t.clas,children:t.children,scope:t.scope,childNodes:[{node:o,clas:t.clas,children:[],scope:t.scope,childNodes:[]}]}}x(Array,{remove:function(e){var n=this.indexOf(e);return n>-1&&this.splice(n,1),this},replace:function(e,n){var t=this.indexOf(e);t>-1&&this.splice(t,1,n)},has:function(e){return this.indexOf(e)>-1}}),x(Node,{on:function(e,n){return this.addEventListener(e,n),this},reappend:function(e){return E(O(this.childNodes),function(e){e.parentNode.removeChild(e)}),this.appendChild(e),this},before:function(e){this.parentNode.insertBefore(e,this)}}),x(NodeList,{on:function(e,n){E(this,function(t){t.on(e,n)})},off:function(e,n){E(this,function(t){t.off(e,n)})}});var F={view:function(e,n,t,o,r){try{var c=document.createDocumentFragment();T(c,t,O(n.children),o,r),o.children=n.children,o.clas=n.clas,e.reappend(c)}catch(e){console.log(e)}},component:function(e){try{var n=p(e.clas.nodeValue,e.scope);if(e.path=[D.$path],k(n))return;a=n.model,i=e.scope,a.__proto__=i;var t=L(e.childNodes),o=e.content.childNodes;M(e.childNodes);var r=new B({view:n.component,model:n.model,action:n.action}),c=function(e,n,t){var o=document.createComment("component:"+n.path);return e.before(o),t.content.node=t.view,{node:n.node,clas:n.clas,children:[t.node],scope:n.scope,resolver:n.resolver,content:n.content,path:n.path,childNodes:[{node:o,children:[],scope:n.scope,childNodes:[]},t.content]}}(t,e,r);o.replace(e,c),t.parentNode&&t.parentNode.replaceChild(r.view,t)}catch(e){console.log(e)}var a,i},when:function(e,n){try{var t=L(e.childNodes),o=document.createDocumentFragment(),r=e.content.childNodes;M(e.childNodes),T(o,e.scope,O(e.children),e.content,n),r.replace(e,r.pop()),t.parentNode&&t.parentNode.replaceChild(o,t)}catch(e){console.log(e)}},each:function(e,n){try{var t=L(e.childNodes),o=document.createDocumentFragment(),r=e.content.childNodes;M(e.childNodes),T(o,e.scope,[e],e.content,n),r.replace(e,r.pop()),t.parentNode&&t.parentNode.replaceChild(o,t)}catch(e){console.log(e)}},express:function(e){try{e.node.nodeValue=f(e.clas.nodeValue,e.scope),"value"==e.node.name&&(e.node.ownerElement.value=e.node.nodeValue)}catch(e){console.log(e)}},attribute:function(e){try{var n=document.createAttribute(f(e.clas.name,scope));n.nodeValue=e.clas.nodeValue,e.node.ownerElement.setAttributeNode(n),e.node.ownerElement.removeAttributeNode(e.node)}catch(e){console.log(e)}}};function L(e,n){try{return E(e,function(e){if(e.node&&e.node.parentNode)return n=e.node,e.node=null,n;n=L(e.childNodes)}),n}catch(e){console.log(e)}}function M(e){e.forEach(function(e){if(e.node&&e.node.parentNode)return e.node.parentNode.removeChild(e.node);e.childNodes&&M(e.childNodes)})}var D={$path:void 0};function B(e){var o={childNodes:[],children:[]},r=this;switch(g(e.model,function(e){!function e(n,t,o){E(n.childNodes,function(n){if(n.path&&n.path.has(t))return F[n.resolver](n,o),!0;n.childNodes[0]&&e(n,t,o)})}(o,e,r),E(D.$attres.get(r),function(e){F[e.resolver](e)})},function(e){D.$path=e}),e.view?"view":"component"){case"view":var c=function e(n,o){var r=o||[];return V(n,function(o){if(n.shift(),new RegExp(d).test(o.nodeValue))return!0;var c={clas:o.cloneNode(!0),children:[]};switch(3==o.nodeType&&""==o.nodeValue.trim()||r.push(c),o.nodeType){case 1:e(O(o.childNodes),c.children);break;default:o.nodeValue.replace(t,function(){e(n,c.children)})}}),r}(function e(t){return E(t,function(t){t.childNodes[0]&&!/(CODE|SCRIPT)/.test(t.nodeName)&&e(O(t.childNodes)),3==t.nodeType&&t.nodeValue.replace(n,function(e){var n=t.nodeValue.split(e);t.parentNode.insertBefore(document.createTextNode(n[0]),t),t.parentNode.insertBefore(document.createTextNode(e.trim()),t),t.nodeValue=t.nodeValue.replace(n[0],"").replace(e,"")})}),t}(O(a=A(e.view))))[0];this.content=o,this.model=e.model,this.action=e.action,this.node=c,this.view=a[0],e.model.$action=e.action,F.view(this.view,c,e.model,o,r);break;case"component":var a=A(e.component);this.view=a[0],this.view.parentNode.removeChild(this.view),this.content=o,this.model=e.model,this.action=e.action,this.component=this.view.outerHTML}}return window.View=B,window.Router=function(e,n){var t=/^:/,o=/^\/(.+)/,r=void 0,c=void 0,a=void 0;this.redreact=u;var i,s=!((i=window.navigator.userAgent).indexOf("compatible")>-1&&i.indexOf("MSIE")>-1||i.indexOf("Trident")>-1||i.indexOf("Edge")>-1)&&window.history&&"pushState"in window.history;function l(e){for(a=Object.keys(n);a.length;){r=a.shift(),c={};var t=r.replace(o,"$1");if(d(t=t.split("/"),e.split("/")))return{component:n[r].component,router:n[r].router,action:n[r].action,after:n[r].after,params:c,path:e}}}function d(e,n){for(;n.length;){var o=e.shift(),r=n.shift();if(r!=o){if(!t.test(o))return!1;o=o.replace(t,""),c[o]=r}}return!0}function u(e){var n=window.location.pathname;window.location.href=n+"#"+e}function h(n){var t=l(window.location.hash.replace(/^#\/?/,""));t?(t.action(t.params),e.model[t.router]=t.component,t.after&&t.after()):void 0!=n&&"load"!=n.type||u("")}window.addEventListener("load",h,h()),window.addEventListener(s?"popstate":"hashchange",h,!1)},window.clone=function e(n){if(Array.isArray(n))return n.map(e);if(n&&"object"===(void 0===n?"undefined":N(n))){var t={};for(var o in n)t[o]=e(n[o]);return t}return n},e.global=D,e.View=B,e}({});
