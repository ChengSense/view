var view=function(t){"use strict";function e(t){"@babel/helpers - typeof";return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function r(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}var a=/(@each|@when|\.when)\s*\((.*)\)\s*\{|\.when\s*\{|\{([^\{\}]*)\}|\}/g,i=/(@each|@when|\.when)\s*(\((.*)\))?\s*\{/,o=/\{([^\{\}]*)\}/,s=/,\s*\.when/g;function u(t,e){Object.keys(t).forEach(function(n){var c=Reflect.get(t,n);e(c,n)})}var h=function(){function t(e){n(this,t),this.type="TAG",this.name=e,this.attrs={}}return r(t,[{key:"setName",value:function(t){if(""!=t)if(this.name){var e=t.indexOf("="),n=t.slice(0,e),c=t.slice(e+2,t.length-1);Reflect.set(this.attrs,n,c)}else this.name=t}},{key:"react",value:function(){if(this.name.startsWith("/"))return")";if(e=this.name,n=document.createElement(e),new RegExp(/<\/\w+>/).test(n.outerHTML)){var t=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(t)}var e,n,c=JSON.stringify(this.attrs);return'React.createRender("'.concat(this.name,'",').concat(c,")")}}]),t}(),f=function(){function t(e,c,r){n(this,t),this.type="FUNC",this.name=c,this.attrs={},this.setName(e,r)}return r(t,[{key:"setName",value:function(t,e){if(this.name.startsWith(".when")){t.push(this);var n=this.name.match(i);this.attrs=n[3],this.name=n[1]}else if(this.name.startsWith("}")){var c=e.slice(0,e.indexOf(this.name));t.push(new l(c)),t.push(this)}else if(this.name.startsWith("{")){var r=e.slice(0,e.indexOf(this.name));t.push(new l(r)),t.push(new l(this.name))}else{var a=e.slice(0,e.indexOf(this.name));t.push(new l(a)),t.push(this);var o=this.name.match(i);this.attrs=o[3],this.name=o[1]}}},{key:"react",value:function(){if(this.name.startsWith("}"))return")";var t=JSON.stringify(this.attrs);return'React.createFunction("'.concat(this.name,'",').concat(t)}}]),t}(),l=function(){function t(e){n(this,t),this.type="TEXT",this.name=e}return r(t,[{key:"setName",value:function(t){this.name=t}},{key:"react",value:function(){var t=this.name.replace(/\n/g,"");return'React.createRender("'.concat(t,'",null)')}}]),t}(),p=function(){function t(e,c){n(this,t),this.func=c,this.scope=e,this.status=null,this.value=[]}return r(t,[{key:"when",value:function(t,e){var n=this.value,c=this.scope;return null==this.status&&t?(this.status=t,d(this.func,c,n),e.forEach(function(t){return v(n,c,t)})):null==this.status&&void 0==t&&(this.status=t,d(this.func,c,n),e.forEach(function(t){return v(n,c,t)})),this}},{key:"forEach",value:function(t,e,n,c){var r,a=this,i=this.value;return d(this.func,this.scope,i),u(t,r=function(o,s){var u=Object.create(a.scope.$target);u[n]=s,u=new Proxy(u,function(t,e,n,c){return{get:function(r,a){return n==a?Reflect.get(e,c):"".concat(n,"$")==a?Reflect.get(e,"".concat(c,"$")):"$target"==a?r:r.hasOwnProperty(a)?Reflect.get(r,a):Reflect.get(t,a)},set:function(r,a,i){return n==a?Reflect.set(e,c,i):r.hasOwnProperty(a)?Reflect.set(r,a,i):Reflect.set(t,a,i)}}}(a.scope,t,e,s));var h=[];return d(r,u,h),c.forEach(function(t){return v(h,u,t)}),h.forEach(function(t){return i.push(t)}),h}),this}},{key:"toString",value:function(){return this.value.join("")}}]),t}();function v(t,e,n){var c=n(e,n);c instanceof p?c.value.forEach(function(e){return t.push(e)}):t.push(c)}var m={createFunction:function(t,e){for(var n=arguments.length,c=new Array(n>2?n-2:0),r=2;r<n;r++)c[r-2]=arguments[r];if("@when"==t)return"\n (_scope,func)=>new Render(_scope,func).when(".concat(w(e),", [").concat(c,"])");if(".when"==t)return"\n .when(".concat(w(e),", [").concat(c,"])");if("@each"==t){var a=e.split(":"),i=a.pop();return"\n (_scope,func)=>new Render(_scope,func).forEach(".concat(w(i),",'").concat(a.shift(),"','").concat(a.shift(),"', [").concat(c,"])")}},createRender:function(t,e){var n;if(e){for(var c=arguments.length,r=new Array(c>2?c-2:0),a=2;a<c;a++)r[a-2]=arguments[a];return'\n (_scope,func)=>React.createElement("'.concat(t,'",_scope,func,').concat(JSON.stringify(e),",").concat(r,")")}return(n=t.match(o))?"\n (_scope,func)=>React.createElement(".concat(w(n[1]),",_scope,func,null)"):'\n (_scope,func)=>React.createElement("'.concat(t,'",_scope,func,null)')},createElement:function(t,e,n,c){if(c){var r=document.createElement(t);d(n,e,[r]);for(var a=arguments.length,i=new Array(a>4?a-4:0),o=4;o<a;o++)i[o-4]=arguments[o];return i.forEach(function(t){var n=t(e,t);n instanceof p?n.value.forEach(function(t){return r.appendChild(t)}):r.appendChild(n)}),function(t,e){u(e,function(e,n){if(n.startsWith("@"))!function(t,e,n,c){var r=n.match(/(.*)\((.*)\)/);if(r){var a=r[1],i=Reflect.get(c,a);t.on(e,i,we.model,r[2])}else{var o=Reflect.get(c,n);t.on(e,o,we.model)}}(t,n.slice(1),e,we.action);else{var c=document.createAttribute(n);c.value=e,t.setAttributeNode(c)}})}(r,c),r}var s=document.createTextNode(t);return d(n,e,[s]),s}};function d(t,e,n){R.cache.forEach(function(c){var r=c.get(t);r?r.child.push.apply(n):c.set(t,{scope:e,child:n})}),R.cache=new Map}function w(t){var e,n;if(t)return t.split("").reduce(function(t,c){return!e&&t.match(/\w/)&&(e="_scope.".concat(t)),"'"==n&&"'"==t?(n=null,e=e.concat(c),c):"'"==n?(e=e.concat(c),c):"'"==t?(n=t,e=e.concat(c),c):t.match(/\W/)&&!t.match(/\.|\$|_/)&&c.match(/\w/)&&!c.match(/\d/)?(e=e.concat("_scope.").concat(c),c):(e=e.concat(c),c)}),e}function y(t){return function(t){return new Function("React","return ".concat(t,";"))(m)}(function(t){var e=[],n=null,c=null,r=null;return function(t){return t.split("")}(t).reduce(function(t,i){if("<"==t){var o=i;return r=">",c=new h,o}if('"'==r&&'"'==i){var s=t.concat(i);return c.setName(s.trim()),r=">",""}if(">"==r&&">"==i){var u=t;return r=null,c.setName(u),e.push(c),c=new l,""}if('"'==i){var p=t.concat(i);return r='"',p}return"<"==i?(c.setName(t),e.push(c),i):"TAG"!=c.type||c.name||" "!=i?"TEXT"==c.type&&(n=t.match(a))?(new f(e,n[0],t),i):t.concat(i):(c.setName(t),"")}),e}(t).filter(function(t){return""!=t.name.trim()}).map(function(t){return t.react()}).join().trim()).replace(s,".when").trim()}function g(t,n,c){return new Proxy(t,function t(n,c,r){var a=new Map,i=new Map;return{get:function(o,s,u){if("$target"==s)return o;if(!o.hasOwnProperty(s)&&Reflect.has(o,s))return Reflect.get(o,s);var h=a.get(s),f=r?"".concat(r,".").concat(s):s;return R.cache.delete(r),R.cache.set(f,i.get(s)),void 0!=h?h:("object"==e(h=Reflect.get(o,s))&&(h=new Proxy(h,t(n,c,f))),a.set(s,h),i.set(s,new Map),R.cache.delete(r),R.cache.set(f,i.get(s)),n.get(f),h)},set:function(t,o,s,u){if(!t.hasOwnProperty(o)&&Reflect.has(t,o))return Reflect.set(t,o,s);var h=a.get(o),f=i.get(o);a.delete(o),i.delete(o),Reflect.set(t,o,s.$target||s);var l=u[o];!function t(n,c,r,a){"object"==e(n)&&"object"==e(c)&&Object.keys(c).forEach(function(i){R.cache=new Map;var o=n[i],s=R.cache;R.cache=new Map;var u=c[i],h=R.cache;"object"!=e(o)&&"object"!=e(u)&&r.set(h,s,i,a),t(o,u,r,a)})}(l,h,n,c);var p=r?"".concat(r,".").concat(o):o;return n.set(new Map([[p,f]]),new Map([[p,i.get(o)]]),o,c),!0}}}(n,c))}function E(t,e,n){this.addEventListener?this.addEventListener(t,function(t){e.forEach(function(e,c){e.forEach(function(e){var r=e?[e]:[];r.push(t),c.apply(n,r)})})},!1):this.attachEvent?this.attachEvent("on".concat(t),function(t){e.forEach(function(e,c){e.forEach(function(e){var r=e?code("[".concat(e,"]"),n):[];r.push(t);var a=Reflect.getPrototypeOf(c),i=Object.assign({},a);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,r)})})}):element["on".concat(t)]=function(t){e.forEach(function(e,c){e.forEach(function(e){var r=e?code("[".concat(e,"]"),n):[];r.push(t);var a=Reflect.getPrototypeOf(c),i=Object.assign({},a);Reflect.setPrototypeOf(i,n||c.$model),c.apply(i,r)})})}}Object.assign(Node.prototype,{on:function(t,e,n,c){if(this._manager)if(this._manager.get(t)){var r=this._manager.get(t);r.get(e)?r.get(e).ones(c):r.set(e,[c])}else{var a=new Map;a.set(e,[c]),this._manager.set(t,a),E.call(this,t,a,n)}else{var i=new Map;i.set(e,[c]),this._manager=new Map,this._manager.set(t,i),E.call(this,t,i,n)}return this},off:function(t,e){if(this._manager){var n=this._manager.get(t);if(void 0==n)return;if(n.delete(e),n.size)return;this._manager.delete(t),function(t,e){this.addEventListener?this.removeEventListener(t,e,!1):this.detachEvent?this.detachEvent("on".concat(t),e):element["on".concat(t)]=null}.call(this,t,e)}return this},reappend:function(t){return this.innerHTML="",this.appendChild(t),this},before:function(t){this.parentNode.insertBefore(t,this)},after:function(t){this.nextSibling?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.appendChild(t)}}),Object.assign(NodeList.prototype,{on:function(t,e){return u(this,function(n){n.on(t,e)}),this},off:function(t,e){return u(this,function(n){n.off(t,e)}),this}});var R={$path:null,cache:new Map},b=function(){function t(e){n(this,t),this.view=e.view,this.model=g(e.model,O,this),this.action=e.action,this.watch=e.watch,this.filter=e.filter,this.creater(e)}return r(t,[{key:"creater",value:function(t){this.view=y(this.view),console.warn(this.view);var e,n,c=(e=this.view,n=this,window.we=n,new Function("we","React","Render","return ".concat(e,";\n    "))(n,m,p));this.node=c(this.model,c)}}]),t}(),O={set:function(t,e,n,c){t.forEach(function(t){t.forEach(function(t,e){var c=t.child;t.child=[];var r=c[0],a="forFunc"==e.name?e(t.scope,n,e):e(t.scope,e);r&&((a=Array.isArray(a)?a:[a]).forEach(function(e){e instanceof p?e.value.forEach(function(e){t.child.push(e),r.before(e)}):(t.child.push(e),r.before(e))}),c.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}))})})},get:function(t){}};return window.View=b,t.React=m,t.Render=p,t.View=b,t.global=R,t.query=function(t){try{return document.querySelectorAll(t)}catch(n){var e=document.createElement("div");return e.innerHTML=t.trim(),e.childNodes}},t}({});
